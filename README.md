# GrowMate - AIãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

LINE LIFF ã‚’å…¥ã‚Šå£ã«ã€æ¥­ç•Œç‰¹åŒ–ã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸€æ‹¬ç”Ÿæˆãƒ»ç®¡ç†ã™ã‚‹ SaaS ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Next.js 15 App Router ã‚’åŸºç›¤ã«ã€ãƒãƒ«ãƒãƒ™ãƒ³ãƒ€ãƒ¼ AIã€WordPress é€£æºã€Stripe ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€Supabase ã«ã‚ˆã‚‹å …ç‰¢ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚’çµ±åˆã—ã¦ã„ã¾ã™ã€‚

## ğŸ§­ ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ¦‚è¦

- LIFF ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«ã€åºƒå‘Šï¼LPï¼ãƒ–ãƒ­ã‚°åˆ¶ä½œã‚’æ”¯æ´ã™ã‚‹ AI ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’æä¾›
- Anthropic Claude Sonnet 4.5 ã¨ OpenAI ã® Fine-tuned ãƒ¢ãƒ‡ãƒ« `ft:gpt-4.1-nano-2025-04-14:personal::BZeCVPK2` ã‚’ç”¨é€”ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆ
- WordPress.com / è‡ªç¤¾ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚’å•ã‚ãªã„æŠ•ç¨¿å–å¾—ã¨ã€Supabase ã¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ³¨é‡ˆä¿å­˜
- Stripe ã‚’ç”¨ã„ãŸæœ‰æ–™ãƒ—ãƒ©ãƒ³ç®¡ç†ã¨ã€ãƒ­ãƒ¼ãƒ«ï¼ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é€£å‹•ã«ã‚ˆã‚‹æ©Ÿèƒ½åˆ¶å¾¡
- ç®¡ç†è€…å‘ã‘ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç®¡ç† UI ã‚’å†…è”µ

## ğŸš€ ä¸»ãªæ©Ÿèƒ½

### LINE LIFF èªè¨¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

- LIFF v2.25 ã‚’åˆ©ç”¨ã—ãŸã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãª LINE ãƒ­ã‚°ã‚¤ãƒ³ã¨è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã® `authMiddleware` ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒ»ãƒ­ãƒ¼ãƒ«åˆ¤å®šã‚’ä¸€å…ƒç®¡ç†
- Supabase `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ IDãƒ»ãƒ­ãƒ¼ãƒ«ãƒ»æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿å­˜

### ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…ã¨é–²è¦§

- æ‹›å¾…ãƒªãƒ³ã‚¯ã®ç™ºè¡Œãƒ»å‰Šé™¤ãƒ»çŠ¶æ…‹å–å¾—ã‚’ `src/hooks/useEmployeeInvitation.ts` ã¨ `src/components/InviteDialog.tsx` ã§ç®¡ç†
- API ã¯ `app/api/employee/route.ts` ã¨ `app/api/employee/invite/*` ãŒæ‹…å½“ã—ã€æ‹›å¾…ãƒªãƒ³ã‚¯ã¯ `app/invite/[token]/page.tsx` ã§å—ã‘ä»˜ã‘
- ã‚ªãƒ¼ãƒŠãƒ¼ã®ã‚¹ã‚¿ãƒƒãƒ•é–²è¦§ã¯ `app/page.tsx` ã®é–²è¦§ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆCookieä»˜ä¸ï¼‰ã¨ `src/server/middleware/auth.middleware.ts` ã®åˆ¤å®šã§å®Ÿç¾

### AI ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ”¯æ´ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹

- `app/chat` é…ä¸‹ã® ChatLayout ã§ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»ãƒ¢ãƒ‡ãƒ«é¸æŠãƒ»AI å¿œç­”ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’çµ±åˆ
- `MODEL_CONFIGS` ã«å®šç¾©ã—ãŸ 7 ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ–ãƒ­ã‚°ä½œæˆãƒ•ãƒ­ãƒ¼ï¼ˆãƒ‹ãƒ¼ã‚ºæ•´ç†ã€œæœ¬æ–‡ä½œæˆï¼‰ã¨åºƒå‘Šï¼LP ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æä¾›
- `POST /api/chat/anthropic/stream` ã«ã‚ˆã‚‹ SSE ã§ Claude å¿œç­”ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æç”»
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«æ¤œç´¢ãƒãƒ¼ã‚’è¿½åŠ ã—ã€`search_chat_sessions` RPCï¼ˆå…¨æ–‡æ¤œç´¢ + `pg_trgm` é¡ä¼¼æ¤œç´¢ï¼‰ã§ã‚¿ã‚¤ãƒˆãƒ«ã‚„æ­£è¦åŒ–æ¸ˆã¿ WordPress URL ã‚’æ¨ªæ–­æ¤œç´¢
- `search_chat_sessions` ã¯ `get_accessible_user_ids` ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒŠãƒ¼/ã‚¹ã‚¿ãƒƒãƒ•å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’è€ƒæ…®
- ã‚¹ãƒ†ãƒƒãƒ—æ¯ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå¤‰æ•°ã¸ `content_annotations` ã¨ äº‹æ¥­è€…ãƒ–ãƒªãƒ¼ãƒ• (`briefs`) ã‚’ãƒãƒ¼ã‚¸ã—ã€æ–‡è„ˆã®å†åˆ©ç”¨ã‚’æœ€å°åŒ–

### ã‚­ãƒ£ãƒ³ãƒã‚¹ç·¨é›†ã¨é¸æŠç¯„å›²ãƒªãƒ©ã‚¤ãƒˆ

- TipTap 3 ãƒ™ãƒ¼ã‚¹ã® `CanvasPanel` ã« Markdown ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼è¦‹å‡ºã—ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ï¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã‚’å®Ÿè£…
- `POST /api/chat/canvas/stream` ã§é¸æŠç¯„å›²ã¨æŒ‡ç¤ºã‚’é€ä¿¡ã—ã€Claude ã® Tool Use ã«ã‚ˆã‚‹å…¨æ–‡å·®ã—æ›¿ãˆã‚’é©ç”¨
- é¸æŠãƒ†ã‚­ã‚¹ãƒˆã®å±¥æ­´ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»Web æ¤œç´¢ãƒˆãƒªã‚¬ãƒ¼ï¼ˆClaude ãƒ„ãƒ¼ãƒ« `web_search_20250305`ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆ

### WordPress é€£æºã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ³¨é‡ˆ

- WordPress.com OAuth ã¨ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆç‰ˆ Application Password ã®ä¸¡å¯¾å¿œï¼ˆ`app/setup/wordpress`ï¼‰
- `WordPressService` ãŒ REST API ã®å€™è£œ URL ã‚’è©¦è¡Œã—ã€æŠ•ç¨¿æƒ…å ±ã‚’æ­£è¦åŒ–
- `app/analytics` ã®ä¸€è¦§ã§æŠ•ç¨¿ã¨ Supabase `content_annotations` ã‚’çªãåˆã‚ã›ã€æœªç´ä»˜ã‘ã®æ³¨é‡ˆã‚‚è¡¨ç¤º
- `AnnotationPanel` ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã®ãƒ¡ãƒ¢ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒšãƒ«ã‚½ãƒŠãƒ»PREP ç­‰ã‚’ä¿å­˜ã—ã€ãƒ–ãƒ­ã‚°ç”Ÿæˆæ™‚ã«å†åˆ©ç”¨

### Google Search Console é€£æº

- `/setup/gsc` ã§ OAuth èªè¨¼çŠ¶æ…‹ãƒ»æ¥ç¶šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¯è¦–åŒ–ã—ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠã‚„é€£æºè§£é™¤ã‚’å®Ÿè¡Œ
- `app/api/gsc/oauth/*` ãŒ Google OAuth 2.0 ã®é–‹å§‹ï¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«å¯¾å¿œã—ã€Supabase `gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
- GSCé€£æºï¼ˆçŠ¶æ…‹ç¢ºèªãƒ»ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å–å¾—ãƒ»é¸æŠæ›´æ–°ãƒ»æ¥ç¶šè§£é™¤ï¼‰ã¯ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³çµŒç”±ã§å‡¦ç†ï¼ˆ`src/components/GscSetupClient.tsx` / `src/server/actions/gscSetup.actions.ts` / `src/server/actions/gscDashboard.actions.ts` ãªã©ï¼‰
- Search Console æ—¥æ¬¡æŒ‡æ¨™ã¯ `gsc_page_metrics`ã€ã‚¯ã‚¨ãƒªæŒ‡æ¨™ã¯ `gsc_query_metrics` ã«ä¿å­˜ã—ã€WordPress æ³¨é‡ˆ (`content_annotations`) ã¨ 1:N ã§ç´ä»˜ã‘å¯èƒ½ï¼ˆnormalized_url ã§ãƒãƒƒãƒãƒ³ã‚°ï¼‰ã€‚
- GSC ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ 30 æ—¥å˜ä½ã§è‡ªå‹•åˆ†å‰²ã—ã€ã‚¯ã‚¨ãƒªæŒ‡æ¨™ã¯ 1,000 è¡Œ Ã— 10 ãƒšãƒ¼ã‚¸ = æœ€å¤§ 10,000 è¡Œã‚’ä¸Šé™ã¨ã—ã¦å–å¾—ã€‚
- è¨˜äº‹ã”ã¨ã®é †ä½è©•ä¾¡ã¨æ”¹å–„ææ¡ˆã‚¹ãƒ†ãƒƒãƒ—ã‚’ `gsc_article_evaluations` / `gsc_article_evaluation_history` ã§ç®¡ç†ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30æ—¥é–“éš”ã§ã€Œã‚¿ã‚¤ãƒˆãƒ«â†’æ›¸ãå‡ºã—â†’æœ¬æ–‡â†’ãƒšãƒ«ã‚½ãƒŠã€ã®é †ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚æ”¹å–„ãŒç¢ºèªã§ããŸã‚‰ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆã€‚
- è©•ä¾¡é–“éš”ã¯30æ—¥å›ºå®šï¼ˆå°†æ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥è¨­å®šæ‹¡å¼µã‚’è¦‹è¾¼ã‚“ã§ã‚µãƒ¼ãƒãƒ¼å´ã§å–å¾—é–¢æ•°ã‚’ç”¨æ„ï¼‰ã€‚

### Google Ads é€£æº

- `/setup/google-ads` ã§ OAuth èªè¨¼çŠ¶æ…‹ãƒ»æ¥ç¶šã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã‚’ç®¡ç†ï¼ˆç¾åœ¨ã¯ç®¡ç†è€…ã®ã¿åˆ©ç”¨å¯èƒ½ï¼‰
- `app/api/google-ads/oauth/*` ãŒ Google OAuth 2.0 ã®é–‹å§‹ï¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«å¯¾å¿œã—ã€Supabase `google_ads_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
- MCCï¼ˆMy Client Centerï¼‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå ´åˆã€é…ä¸‹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠå¯èƒ½
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒ1ã¤ã®å ´åˆã¯è‡ªå‹•çš„ã«é¸æŠã€è¤‡æ•°ã®å ´åˆã¯é¸æŠç”»é¢ã‚’è¡¨ç¤º
- é¸æŠã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDï¼ˆ`customer_id`ï¼‰ã¯ `google_ads_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã•ã‚Œã€ä»Šå¾Œã®APIå‘¼ã³å‡ºã—ã§ä½¿ç”¨
- Google Ads API ã®é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ`GOOGLE_ADS_DEVELOPER_TOKEN`ï¼‰ãŒå¿…è¦ï¼ˆMCCã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ãŒç™ºè¡Œï¼‰

### ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¨æ¨©é™

- Stripe v17.7 ã§ Checkout / Billing Portal / Subscription çŠ¶æ…‹ç¢ºèªã‚’å®Ÿè£…ï¼ˆ`SubscriptionService`ï¼‰
- `SubscriptionService` ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ `useSubscriptionStatus` ã§ UI å´ã‹ã‚‰æœ‰åŠ¹ãƒ—ãƒ©ãƒ³ã‚’åˆ¤å®š
- `authMiddleware` ãŒ `requiresSubscription` ã‚’è¿”ã—ã€æœ‰æ–™æ©Ÿèƒ½ã¸ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’é©ç”¨
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ï¼ˆ`trial` / `paid` / `admin` / `unavailable`ï¼‰ã‚’ Supabase å´ã§ç®¡ç†ã—ã€LIFF ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•åŒæœŸï¼ˆ`trial` ã¯ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãŒ1æ—¥3å›ã¾ã§ã€`paid` ã¯ç„¡åˆ¶é™ï¼‰
- ã‚ªãƒ¼ãƒŠãƒ¼/ã‚¹ã‚¿ãƒƒãƒ•å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ã§ã¯ã€ã‚ªãƒ¼ãƒŠãƒ¼ã¯èª­ã¿å–ã‚Šä¸­å¿ƒã®æ¨©é™ã€ã‚¹ã‚¿ãƒƒãƒ•ã¯ã‚ªãƒ¼ãƒŠãƒ¼ã®å‚ç…§ã‚’è¨±å¯
- `role='owner'` ã®èƒ½åŠ›å®šç¾©: é–²è¦§ï¼ˆå¯ï¼‰/ ä¸€èˆ¬çš„ãªç·¨é›†ãƒ»ä¿å­˜ï¼ˆä¸å¯ï¼‰/ èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆå¯ï¼‰/ ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆWordPressãƒ»Google Search Console ã®ã¿å¯ï¼‰
- ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å®Ÿè¡Œå¯å¦ã¯ `canRunBulkImport` ã«æº–æ‹ ï¼ˆè¨±å¯: `owner` / `paid(owner)` / `admin` / `trial`ã€æ‹’å¦: `paid(staff)` / `unavailable` / `null`ï¼‰

### ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

- `/admin` ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç®¡ç† UI ã‚’æä¾›
- `/admin/prompts` ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¿å­˜ã€æš—é»™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆcontent ç³»å¤‰æ•°ï¼‰èª¬æ˜ã‚’è¡¨ç¤º
- `/admin/users` ã§ã¯ãƒ­ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆå¾Œã« `POST /api/auth/clear-cache` ã‚’å‘¼ã³å‡ºã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³æ™‚ç„¡åŠ¹åŒ–

### äº‹æ¥­è€…æƒ…å ±ãƒ–ãƒªãƒ¼ãƒ•

- `/business-info` ã§ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦ã‚„ 5W2Hã€æ±ºæ¸ˆæ–¹æ³•ãªã©ã‚’å…¥åŠ›ã—ã€`briefs` ãƒ†ãƒ¼ãƒ–ãƒ«ã« JSON ã¨ã—ã¦ä¿å­˜
- ãƒ–ãƒªãƒ¼ãƒ•ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤‰æ•°ã¸æµç”¨ã•ã‚Œã€åºƒå‘Šæ–‡ã‚„ LP ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è‡ªå‹•è£œå®Œ

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å°ç·š

- `/setup/wordpress` ã§ WordPress é€£æºã®åˆæœŸè¨­å®šã‚’æ¡ˆå†…
- `/setup/gsc` ã§ Google Search Console OAuth é€£æºã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠã‚’ç®¡ç†
- `/setup/google-ads` ã§ Google Ads OAuth é€£æºã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠã‚’ç®¡ç†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
- `/analytics` ã§ WordPress æŠ•ç¨¿ã¨æ³¨é‡ˆã‚’ç…§åˆ

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph TB
  subgraph Client["Next.js 15 (App Router)"]
    LIFFProvider["LIFF Provider & Auth Hooks"]
    ChatUI["Chat Layout / Session Sidebar"]
    Canvas["CanvasPanel (TipTap)"]
    Annotation["AnnotationPanel"]
    Analytics["Analytics Table"]
    BusinessForm["Business Info Form"]
    AdminUI["Admin Dashboards"]
    GscSetup["GSC Setup Dashboard"]
    GscDashboard["GSC Analytics Dashboard"]
    Ga4Dashboard["GA4 Analytics Dashboard"]
  end

  subgraph Server["Next.js Route Handlers & Server Actions"]
    AuthMiddleware["authMiddleware"]
    ChatStream["/api/chat/anthropic/stream"]
    CanvasStream["/api/chat/canvas/stream"]
    WordPressAPI["/api/wordpress/*"]
    AdminAPI["/api/admin/*"]
    SubscriptionAPI["/api/refresh, /api/user/*"]
    GscAPI["/api/gsc/*"]
    Ga4API["/api/ga4/*"]
    GscCron["/api/cron/gsc-evaluate"]
    ServerActions["server/actions/*"]
  end

  subgraph Data["Supabase PostgreSQL"]
    UsersTable["users"]
    SessionsTable["chat_sessions"]
    MessagesTable["chat_messages"]
    BriefsTable["briefs"]
    AnnotationsTable["content_annotations"]
    PromptsTable["prompt_templates"]
    VersionsTable["prompt_versions"]
    WordpressTable["wordpress_settings"]
    GscCredentials["gsc_credentials"]
    GscPageMetrics["gsc_page_metrics"]
    GscQueryMetrics["gsc_query_metrics"]
    GscEvaluations["gsc_article_evaluations"]
    GscHistory["gsc_article_evaluation_history"]
  end

  subgraph External["External Services"]
    LINE["LINE Platform (LIFF / Verify)"]
    Anthropic["Anthropic Claude"]
    OpenAI["OpenAI GPT-4.1 nano FT"]
    Stripe["Stripe Subscriptions"]
    WordPress["WordPress REST API"]
    GSC["Google Search Console API"]
    GA4["Google Analytics 4 API"]
  end

  LIFFProvider --> AuthMiddleware
  ChatUI --> ChatStream
  Canvas --> CanvasStream
  Annotation --> ServerActions
  Analytics --> WordPressAPI
  BusinessForm --> ServerActions
  AdminUI --> ServerActions
  GscSetup --> GscAPI
  GscDashboard --> GscAPI
  Ga4Dashboard --> Ga4API

  ServerActions --> UsersTable
  ServerActions --> BriefsTable
  ServerActions --> AnnotationsTable
  ChatStream --> MessagesTable
  ChatStream --> SessionsTable
  WordPressAPI --> WordpressTable
  AdminAPI --> PromptsTable
  AdminAPI --> VersionsTable
  GscAPI --> GscCredentials
  GscAPI --> GscPageMetrics
  GscAPI --> GscQueryMetrics
  GscAPI --> GscEvaluations
  GscCron --> GscEvaluations
  GscCron --> GscHistory

  AuthMiddleware --> LINE
  ChatStream --> Anthropic
  CanvasStream --> Anthropic
  ChatStream --> OpenAI
  SubscriptionAPI --> Stripe
  WordPressAPI --> WordPress
  GscAPI --> GSC
  Ga4API --> GA4
  GscCron --> GSC
```

## ğŸ”„ èªè¨¼ãƒ•ãƒ­ãƒ¼

### 1. LINE LIFF èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆåŸºæœ¬èªè¨¼ï¼‰

**å¯¾è±¡**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼
**ç›®çš„**: ã‚¢ãƒ—ãƒªã¸ã®åŸºæœ¬èªè¨¼
**ä¿å­˜å…ˆ**: `users` ãƒ†ãƒ¼ãƒ–ãƒ«

```mermaid
sequenceDiagram
    participant U as User
    participant C as Client (LIFF)
    participant L as LINE Platform
    participant S as Next.js Server
    participant DB as Supabase

    U->>C: ã‚¢ãƒ—ãƒªã¸ã‚¢ã‚¯ã‚»ã‚¹
    C->>L: LIFF åˆæœŸåŒ–
    alt æœªãƒ­ã‚°ã‚¤ãƒ³
        C->>L: LINE Login ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        L->>U: èªè¨¼ç”»é¢ã‚’è¡¨ç¤º
        U->>L: èªè¨¼è¨±å¯
        L->>C: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ä»˜ä¸
    end
    C->>S: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    S->>L: Verify API ç…§ä¼š
    L->>S: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”å´
    S->>DB: users ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ upsert / last_login_at æ›´æ–°
    opt ç®¡ç†è€… or ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç¢ºèª
        S->>DB: role / subscription state ã‚’å‚ç…§
    end
    S->>C: èªè¨¼æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¿”å´
```

### 2. WordPress OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼

**å¯¾è±¡**: ç®¡ç†è€…ã®ã¿
**ç›®çš„**: WordPress.com ã‚µã‚¤ãƒˆã¨ã®é€£æºï¼ˆæŠ•ç¨¿å–å¾—ãƒ»åŒæœŸï¼‰
**ä¿å­˜å…ˆ**: `wordpress_settings` ãƒ†ãƒ¼ãƒ–ãƒ«
**å¿…è¦ãªç’°å¢ƒå¤‰æ•°**: `WORDPRESS_COM_CLIENT_ID`, `WORDPRESS_COM_CLIENT_SECRET`, `WORDPRESS_COM_REDIRECT_URI`, `COOKIE_SECRET`

```mermaid
sequenceDiagram
    participant U as User (Admin)
    participant C as Client
    participant S as Next.js Server
    participant WP as WordPress.com OAuth
    participant DB as Supabase

    U->>C: WordPressé€£æºã‚’é–‹å§‹
    C->>S: /api/wordpress/oauth/start
    S->>S: LINEèªè¨¼ãƒã‚§ãƒƒã‚¯ & ç®¡ç†è€…æ¨©é™ç¢ºèª
    S->>S: OAuth state ç”Ÿæˆãƒ»Cookieä¿å­˜
    S->>WP: OAuthèªè¨¼URLã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    WP->>U: WordPress.comèªè¨¼ç”»é¢è¡¨ç¤º
    U->>WP: èªè¨¼è¨±å¯
    WP->>S: /api/wordpress/oauth/callback?code=xxx&state=yyy
    S->>S: stateæ¤œè¨¼
    S->>WP: ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (code â†’ access_token)
    WP->>S: access_token, refresh_token è¿”å´
    S->>DB: wordpress_settings ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
    S->>C: é€£æºå®Œäº†ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

### 3. Google Search Console OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼

**å¯¾è±¡**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼
**ç›®çš„**: Google Search Console ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»è¨˜äº‹è©•ä¾¡
**ä¿å­˜å…ˆ**: `gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«
**å¿…è¦ãªç’°å¢ƒå¤‰æ•°**: `GOOGLE_OAUTH_CLIENT_ID`, `GOOGLE_OAUTH_CLIENT_SECRET`, `GOOGLE_SEARCH_CONSOLE_REDIRECT_URI`, `COOKIE_SECRET`

```mermaid
sequenceDiagram
    participant U as User
    participant C as Client
    participant S as Next.js Server
    participant G as Google OAuth
    participant GSC as Google Search Console API
    participant DB as Supabase

    U->>C: GSCé€£æºã‚’é–‹å§‹
    C->>S: /api/gsc/oauth/start
    S->>S: LINEèªè¨¼ãƒã‚§ãƒƒã‚¯
    S->>S: OAuth state ç”Ÿæˆãƒ»Cookieä¿å­˜
    S->>G: OAuthèªè¨¼URLã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ<br/>(scope: webmasters.readonly)
    G->>U: Googleèªè¨¼ç”»é¢è¡¨ç¤º
    U->>G: èªè¨¼è¨±å¯
    G->>S: /api/gsc/oauth/callback?code=xxx&state=yyy
    S->>S: stateæ¤œè¨¼
    S->>G: ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (code â†’ tokens)
    G->>S: access_token, refresh_token, scope è¿”å´
    S->>DB: gsc_credentials ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
    S->>C: é€£æºå®Œäº†ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

    Note over U,DB: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠãƒ•ã‚§ãƒ¼ã‚º
    U->>C: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠç”»é¢
    C->>S: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§å–å¾—
    S->>GSC: Sites.list API å‘¼ã³å‡ºã—
    GSC->>S: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ã‚’è¿”å´
    S->>C: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ã‚’è¡¨ç¤º
    U->>C: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é¸æŠ
    C->>S: é¸æŠã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä¿å­˜
    S->>DB: gsc_credentials ã® property_uri ã‚’æ›´æ–°
    S->>C: è¨­å®šå®Œäº†
```

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Next.js 15.5.12 (App Router), React 19.2.3, TypeScript 5.9.3
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS v4, Radix UI, shadcn/ui, lucide-react, tw-animate-css
- **ãƒ†ãƒ¼ãƒ**: next-themes 0.4.6 (ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ)
- **ã‚¨ãƒ‡ã‚£ã‚¿**: TipTap 3.7.2 + lowlight 3.3.0 (ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ)
- **ã‚°ãƒ©ãƒ•**: Recharts 3.5.0
- **é€šçŸ¥**: Sonner 2.0.7 (Toast)
- **Markdown**: react-markdown 10.1.0

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- **API**: Next.js Route Handlers & Server Actions
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Supabase JS 2.75.0 (PostgreSQL + Row Level Security)
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod 4.1.12
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: Node.jsï¼ˆLTS æ¨å¥¨ï¼‰

### AIãƒ»LLM

- **Anthropic**: Claude Sonnet 4.5 (SSE ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°)
- **OpenAI**: GPT-4.1 nano (Fine-tuned ãƒ¢ãƒ‡ãƒ«å«ã‚€)

### èªè¨¼

- **LINE**: LIFF v2.25.1
- **OAuth 2.0**: WordPress.com, Google (Search Console, Google Ads)
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: Vercel Edge Cookie ã‚¹ãƒˆã‚¢
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: ç‹¬è‡ªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã‚ˆã‚‹ãƒ­ãƒ¼ãƒ«åˆ¤å®š

### æ±ºæ¸ˆ

- **Stripe**: 17.7.0 (Checkout, Billing Portal, Subscription API)

### å¤–éƒ¨é€£æº

- **WordPress REST API**: æŠ•ç¨¿å–å¾—ãƒ»åŒæœŸ
- **Google Search Console API**: æ¤œç´¢ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»è¨˜äº‹è©•ä¾¡
- **Google Analytics 4 API**: ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—
- **Google Ads API**: åºƒå‘Šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆMCCã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œï¼‰

### é–‹ç™ºãƒ„ãƒ¼ãƒ«

- **å‹ãƒã‚§ãƒƒã‚¯**: TypeScript strict mode
- **ãƒªãƒ³ã‚¿ãƒ¼**: ESLint 9, eslint-config-next
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: Prettier 3.5.3
- **ãƒ“ãƒ«ãƒ‰**: Turbopackï¼ˆé–‹ç™ºï¼‰/ Next.js build
- **ä¾å­˜é–¢ä¿‚è§£æ**: Knip 5.77.1
- **ãƒ­ãƒ¼ã‚«ãƒ«å…¬é–‹**: ngrok (æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³)

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```mermaid
erDiagram
    users {
        uuid id PK
        text line_user_id UK
        text line_display_name
        text line_picture_url
        text line_status_message
        text full_name
        text role
        text stripe_customer_id
        text stripe_subscription_id
        bigint last_login_at
        bigint created_at
        bigint updated_at
    }

    chat_sessions {
        text id PK
        text user_id FK
        text title
        text system_prompt
        bigint last_message_at
        bigint created_at
    }

    chat_messages {
        text id PK
        text user_id FK
        text session_id FK
        text role
        text content
        text model
        bigint created_at
    }

    briefs {
        uuid id PK
        text user_id UK
        jsonb data
        bigint created_at
        bigint updated_at
    }

    content_annotations {
        uuid id PK
        text user_id FK
        bigint wp_post_id
        text session_id
        text canonical_url
        text wp_post_title
        text wp_excerpt
        text wp_content_text
        text wp_categories
        text main_kw
        text kw
        text impressions
        text persona
        text needs
        text goal
        text prep
        text basic_structure
        text opening_proposal
        timestamptz created_at
        timestamptz updated_at
    }

    wordpress_settings {
        uuid id PK
        uuid user_id UK,FK
        text wp_type
        text wp_client_id
        text wp_client_secret
        text wp_site_id
        text wp_site_url
        text wp_username
        text wp_application_password
        text wp_access_token
        text wp_refresh_token
        timestamptz wp_token_expires_at
        text[] wp_content_types
        timestamptz created_at
        timestamptz updated_at
    }

    prompt_templates {
        uuid id PK
        text name
        text description
        text category
        boolean is_active
        uuid created_by FK
        timestamptz created_at
        timestamptz updated_at
    }

    prompt_versions {
        uuid id PK
        uuid template_id FK
        integer version_number
        text content
        text change_summary
        uuid created_by FK
        timestamptz created_at
    }

    gsc_credentials {
        uuid id PK
        uuid user_id UK,FK
        text google_account_email
        text refresh_token
        text access_token
        timestamptz access_token_expires_at
        text[] scope
        text property_uri
        text property_type
        text property_display_name
        text permission_level
        boolean verified
        timestamptz last_synced_at
        timestamptz created_at
        timestamptz updated_at
    }

    gsc_page_metrics {
        uuid id PK
        uuid user_id FK
        uuid content_annotation_id FK
        text property_uri
        text search_type
        date date
        text url
        text normalized_url
        integer clicks
        integer impressions
        numeric ctr
        numeric position
        timestamptz imported_at
    }

    gsc_query_metrics {
        uuid id PK
        uuid user_id FK
        text property_uri
        text property_type
        text search_type
        date date
        text url
        text normalized_url
        text query
        text query_normalized
        integer clicks
        integer impressions
        numeric ctr
        numeric position
        uuid content_annotation_id FK
        timestamptz imported_at
        timestamptz created_at
        timestamptz updated_at
    }

    gsc_article_evaluations {
        uuid id PK
        uuid user_id FK
        uuid content_annotation_id FK
        text property_uri
        smallint current_suggestion_stage
        date last_evaluated_on
        date base_evaluation_date
        integer cycle_days
        integer evaluation_hour
        numeric last_seen_position
        text status
        timestamptz created_at
        timestamptz updated_at
    }

    gsc_article_evaluation_history {
        uuid id PK
        uuid user_id FK
        uuid content_annotation_id FK
        date evaluation_date
        smallint stage
        numeric previous_position
        numeric current_position
        text outcome_type
        text outcome
        text error_code
        text error_message
        boolean suggestion_applied
        text suggestion_summary
        boolean is_read
        timestamptz created_at
    }

    google_ads_credentials {
        uuid id PK
        uuid user_id UK,FK
        text google_account_email
        text access_token
        text refresh_token
        timestamptz access_token_expires_at
        text[] scope
        text customer_id
        text manager_customer_id
        timestamptz created_at
        timestamptz updated_at
    }

    ga4_page_metrics_daily {
        uuid id PK
        uuid user_id FK
        date date
        text page_path
        integer sessions
        integer users
        integer engagement_time_sec
        numeric bounce_rate
        integer cv_event_count
        integer scroll_90_event_count
        integer search_clicks
        integer impressions
        numeric ctr
        boolean is_sampled
        boolean is_partial
        timestamptz imported_at
        timestamptz created_at
        timestamptz updated_at
    }

    heading_flow_sessions {
        uuid id PK
        uuid user_id FK
        text status
        jsonb metadata
        timestamptz created_at
        timestamptz updated_at
    }

    heading_flow_stages {
        uuid id PK
        uuid session_id FK
        text stage_key
        text status
        jsonb result_data
        timestamptz created_at
        timestamptz updated_at
    }

    users ||--o{ chat_sessions : owns
    chat_sessions ||--o{ chat_messages : contains
    users ||--|| briefs : "stores one brief"
    users ||--o{ content_annotations : annotates
    users ||--o| wordpress_settings : configures
    users ||--o| gsc_credentials : "has GSC auth"
    users ||--o| google_ads_credentials : "has Google Ads auth"
    users ||--o{ gsc_page_metrics : owns
    users ||--o{ gsc_query_metrics : owns
    users ||--o{ gsc_article_evaluation_history : owns
    users ||--o{ ga4_page_metrics_daily : owns
    users ||--o{ heading_flow_sessions : owns
    heading_flow_sessions ||--o{ heading_flow_stages : "contains stages"
    users ||--o{ prompt_templates : creates
    users ||--o{ prompt_versions : creates
    prompt_templates ||--o{ prompt_versions : "has versions"
    content_annotations ||--o| gsc_article_evaluations : "monitored by"
    content_annotations ||--o{ gsc_page_metrics : "tracked by"
    content_annotations ||--o{ gsc_query_metrics : "tracked by"
    content_annotations ||--o{ gsc_article_evaluation_history : "evaluated in"
    gsc_article_evaluations ||--o{ gsc_article_evaluation_history : "has history"
```

## ğŸ“‹ ç’°å¢ƒå¤‰æ•°ï¼ˆ24 é …ç›®: å¿…é ˆ12é …ç›®ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³12é …ç›®ï¼‰

`src/env.ts` ã§å³æ ¼ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã‚‹ç’°å¢ƒå¤‰æ•°ã«åŠ ãˆã€Route Handler ã§ç›´æ¥å‚ç…§ã™ã‚‹ `CRON_SECRET` ã‚’å«ã¿ã¾ã™ã€‚`.env.local` ã‚’æ‰‹å‹•ã§ç”¨æ„ã—ã¦ãã ã•ã„ã€‚

| ç¨®åˆ¥   | å¤‰æ•°å                               | å¿…é ˆ                                | ç”¨é€”                                                                                        |
| ------ | ------------------------------------ | ----------------------------------- | ------------------------------------------------------------------------------------------- |
| Server | `SUPABASE_SERVICE_ROLE`              | âœ…                                  | ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ç‰¹æ¨©æ“ä½œç”¨ Service Role ã‚­ãƒ¼                                                  |
| Server | `STRIPE_ENABLED`                     | ä»»æ„                                | Stripe æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–ãƒ•ãƒ©ã‚°ï¼ˆ`true` / `false`ï¼‰                                               |
| Server | `STRIPE_SECRET_KEY`                  | âœ…ï¼ˆStripe ç„¡åŠ¹ã§ã‚‚ãƒ€ãƒŸãƒ¼å€¤å¿…é ˆï¼‰   | Stripe API å‘¼ã³å‡ºã—ç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ                                                           |
| Server | `STRIPE_PRICE_ID`                    | âœ…ï¼ˆStripe ç„¡åŠ¹ã§ã‚‚ãƒ€ãƒŸãƒ¼å€¤å¿…é ˆï¼‰   | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã™ã‚‹ Price ID                                                       |
| Server | `OPENAI_API_KEY`                     | âœ…                                  | Fine-tuned ãƒ¢ãƒ‡ãƒ«åˆ©ç”¨æ™‚ã® OpenAI ã‚­ãƒ¼                                                       |
| Server | `ANTHROPIC_API_KEY`                  | âœ…                                  | Claude ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”¨ API ã‚­ãƒ¼                                                            |
| Server | `LINE_CHANNEL_ID`                    | âœ…                                  | LINE Login ç”¨ãƒãƒ£ãƒãƒ« ID                                                                    |
| Server | `LINE_CHANNEL_SECRET`                | âœ…                                  | LINE Login ç”¨ãƒãƒ£ãƒãƒ«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ                                                           |
| Server | `GOOGLE_OAUTH_CLIENT_ID`             | ä»»æ„ï¼ˆGSC/GA4 é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰    | Google Search Console / GA4 OAuth ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID                                         |
| Server | `GOOGLE_OAUTH_CLIENT_SECRET`         | ä»»æ„ï¼ˆGSC/GA4 é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰    | Google Search Console / GA4 OAuth ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ                                |
| Server | `GOOGLE_SEARCH_CONSOLE_REDIRECT_URI` | ä»»æ„ï¼ˆGSC/GA4 é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰    | Google OAuth ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆï¼ˆ`https://<host>/api/gsc/oauth/callback` ãªã©ï¼‰               |
| Server | `GOOGLE_ADS_REDIRECT_URI`            | ä»»æ„ï¼ˆGoogle Ads é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰ | Google Ads OAuth ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆï¼ˆ`https://<host>/api/google-ads/oauth/callback` ãªã©ï¼‰    |
| Server | `GOOGLE_ADS_DEVELOPER_TOKEN`         | ä»»æ„ï¼ˆGoogle Ads é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰ | Google Ads API é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆMCCã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ãŒç™ºè¡Œï¼‰                                |
| Server | `WORDPRESS_COM_CLIENT_ID`            | ä»»æ„ï¼ˆWordPress é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰  | WordPress.com OAuth ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID                                                       |
| Server | `WORDPRESS_COM_CLIENT_SECRET`        | ä»»æ„ï¼ˆWordPress é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰  | WordPress.com OAuth ç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ                                              |
| Server | `WORDPRESS_COM_REDIRECT_URI`         | ä»»æ„ï¼ˆWordPress é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰  | WordPress OAuth ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆï¼ˆ`https://<host>/api/wordpress/oauth/callback` ãªã©ï¼‰      |
| Server | `COOKIE_SECRET`                      | ä»»æ„                                | WordPress / Google Search Console / Google Ads OAuth ã®ã‚»ã‚­ãƒ¥ã‚¢ãª Cookie ç®¡ç†ç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ |
| Server | `CRON_SECRET`                        | ä»»æ„ï¼ˆGSCè©•ä¾¡ãƒãƒƒãƒåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰   | `/api/cron/gsc-evaluate` ã® Bearer èªè¨¼ç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ                                       |
| Client | `NEXT_PUBLIC_LIFF_ID`                | âœ…                                  | LIFF ã‚¢ãƒ—ãƒª ID                                                                              |
| Client | `NEXT_PUBLIC_LIFF_CHANNEL_ID`        | âœ…                                  | LIFF Channel ID                                                                             |
| Client | `NEXT_PUBLIC_SUPABASE_URL`           | âœ…                                  | Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ URL                                                                   |
| Client | `NEXT_PUBLIC_SUPABASE_ANON_KEY`      | âœ…                                  | Supabase anon ã‚­ãƒ¼                                                                          |
| Client | `NEXT_PUBLIC_SITE_URL`               | âœ…                                  | ã‚µã‚¤ãƒˆã®å…¬é–‹ URL                                                                            |
| Client | `NEXT_PUBLIC_STRIPE_ENABLED`         | ä»»æ„                                | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã® Stripe æœ‰åŠ¹åŒ–ãƒ•ãƒ©ã‚°ï¼ˆæœªè¨­å®šæ™‚ã¯ `STRIPE_ENABLED` ã‚’ç¶™æ‰¿ï¼‰                |

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### å¿…è¦æ¡ä»¶

- **Node.js**: LTS æ¨å¥¨
- **npm**: 9 ä»¥ä¸Š
- **Supabase æ¥ç¶šæƒ…å ±**ï¼ˆç®¡ç†è€…ã‹ã‚‰å–å¾—ï¼‰
- **LINE æ¥ç¶šæƒ…å ±**ï¼ˆç®¡ç†è€…ã‹ã‚‰å–å¾—ï¼‰
- **Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ©ç”¨æ™‚ï¼‰
- **ngrok ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼ˆLIFF ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç”¨ã€å¿…é ˆï¼‰

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ã¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd industry-specific-mc-training

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install
```

### 2. Supabase ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 2.1 æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¥ç¶šæƒ…å ±ã‚’å–å¾—

**é‡è¦**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æœ¬ç•ªç’°å¢ƒã¨é–‹ç™ºç’°å¢ƒã§Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å…±æœ‰ã—ã¦ã„ã¾ã™ã€‚æ–°è¦ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…ã‹ã‚‰ä»¥ä¸‹ã®æ¥ç¶šæƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼š
   - **Project URL** (`https://xxxxx.supabase.co`)
   - **anon public key**
   - **service_role key**ï¼ˆç§˜å¯†æƒ…å ±ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å°‚ç”¨ï¼‰

2. ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’ `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šã—ã¾ã™ï¼ˆè©³ç´°ã¯ã€Œ6. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã€ã‚’å‚ç…§ï¼‰

#### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã«ã¤ã„ã¦

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ—¢ã«æœ¬ç•ªç’°å¢ƒã«é©ç”¨æ¸ˆã¿ã§ã™
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ã€æ—¢å­˜ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¾ã™
- **ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ã¯ä¸è¦ã§ã™**ï¼ˆ`npx supabase db push` ã¯å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ï¼‰

**æ³¨æ„äº‹é …:**

- æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã¨åŒã˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿æ“ä½œã«ã¯ååˆ†æ³¨æ„ã—ã¦ãã ã•ã„
- ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ä½œæˆæ™‚ã¯ã€è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«ç´ä»˜ã‘ã¦ä½œæˆã—ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª¤ã£ã¦å¤‰æ›´ãƒ»å‰Šé™¤ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„
- ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€å¿…ãšãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…ã«ç›¸è«‡ã—ã¦ãã ã•ã„
- ç›´è¿‘ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚è¦:
  - ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒãƒ£ãƒƒãƒˆ/æ³¨é‡ˆã®æ‰€æœ‰è€…ç§»è¡Œ
  - `get_accessible_user_ids` è¿½åŠ ã¨ `search_chat_sessions` / `get_sessions_with_messages` æ›´æ–°
  - ã‚ªãƒ¼ãƒŠãƒ¼/ã‚¹ã‚¿ãƒƒãƒ•å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹å‘ã‘ RLS æ›´æ–°ã€ã‚ªãƒ¼ãƒŠãƒ¼ã®æ›¸ãè¾¼ã¿ç¦æ­¢
  - `content_annotations.session_id` ã®åˆ¶ç´„è¦‹ç›´ã—ï¼ˆUNIQUE ã¸å¤‰æ›´ï¼‰

### 3. LINE ã®è¨­å®š

**é‡è¦**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æœ¬ç•ªç’°å¢ƒã¨é–‹ç™ºç’°å¢ƒã§LINE Login ChannelãŠã‚ˆã³LIFFã‚¢ãƒ—ãƒªã‚’å…±æœ‰ã—ã¦ã„ã¾ã™ã€‚æ–°è¦ã«ä½œæˆã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

#### 3.1 æ—¢å­˜ã®LINEæ¥ç¶šæƒ…å ±ã‚’å–å¾—

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…ã‹ã‚‰ä»¥ä¸‹ã®æ¥ç¶šæƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼š

- **LINE Channel ID**: LINE Login ãƒãƒ£ãƒãƒ«ã®ãƒãƒ£ãƒãƒ« ID
- **LINE Channel Secret**: LINE Login ãƒãƒ£ãƒãƒ«ã®ãƒãƒ£ãƒãƒ«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- **LIFF ID**: æ—¢å­˜ã®LIFFã‚¢ãƒ—ãƒªã®IDï¼ˆ`<liff-id>` å½¢å¼ï¼‰

ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’ `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®šã—ã¾ã™ï¼ˆè©³ç´°ã¯ã€Œ5. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã€ã‚’å‚ç…§ï¼‰ã€‚

#### 3.2 LINEè¨­å®šã®æ³¨æ„äº‹é …

**æ³¨æ„äº‹é …:**

- æœ¬ç•ªç’°å¢ƒã¨åŒã˜LINE ChannelãŠã‚ˆã³LIFFã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã—ã¾ã™
- **LINE Developers Consoleã§ã®è¨­å®šå¤‰æ›´ã¯æœ¬ç•ªç’°å¢ƒã«ã‚‚å½±éŸ¿ã—ã¾ã™**
- LIFF ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã‚„ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ URL ã®å¤‰æ›´ã¯è¡Œã‚ãªã„ã§ãã ã•ã„
- è¨­å®šå¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€å¿…ãšãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…ã«ç›¸è«‡ã—ã¦ãã ã•ã„

### 4. Stripe ã®è¨­å®šï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### 4.1 Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆã¨ã‚­ãƒ¼å–å¾—

1. [Stripe Dashboard](https://dashboard.stripe.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€Œé–‹ç™ºè€…ã€â†’ã€ŒAPI ã‚­ãƒ¼ã€ã‹ã‚‰ä»¥ä¸‹ã‚’å–å¾—ï¼š
   - **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼**ï¼ˆ`sk_test_...` ã¾ãŸã¯ `sk_live_...`ï¼‰

#### 4.2 ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å•†å“ã¨ Price ID ã®ä½œæˆ

1. Stripe Dashboard ã®ã€Œå•†å“ã€â†’ã€Œå•†å“ã‚’è¿½åŠ ã€
2. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å•†å“ã‚’ä½œæˆã—ã€**Price ID** (`price_xxxxx`) ã‚’ã‚³ãƒ”ãƒ¼

#### 4.3 Stripe ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å ´åˆ

- `STRIPE_ENABLED=false` ã‚’è¨­å®š
- ãŸã ã—ã€`STRIPE_SECRET_KEY` ã¨ `STRIPE_PRICE_ID` ã«ã¯ãƒ€ãƒŸãƒ¼å€¤ï¼ˆä¾‹: `sk_test_dummy`ï¼‰ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### 5. Google Search Console / GA4 ã®è¨­å®šï¼ˆGSC/GA4 é€£æºæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### 5.1 Google Cloud Console ã§ã®è¨­å®š

**é‡è¦**: GSC/GA4 é€£æºæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€Google Cloud Console ã§ OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚GSC ã¨ GA4 ã¯åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

##### 5.1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¾ãŸã¯é¸æŠ

1. [Google Cloud Console](https://console.cloud.google.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã‹ã€æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

##### 5.1.2 OAuth consent screenï¼ˆåŒæ„ç”»é¢ï¼‰ã®è¨­å®š

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€ŒOAuth consent screenã€ã«ç§»å‹•
2. **User Type** ã‚’é¸æŠï¼š
   - **å¤–éƒ¨**ï¼ˆæ¨å¥¨ï¼‰: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¦é–‹ç™ºãƒ»æ¤œè¨¼ãŒå¯èƒ½
   - **å†…éƒ¨**: Google Workspace çµ„ç¹”å†…ã®ã¿ï¼ˆé€šå¸¸ã¯å¤–éƒ¨ã‚’é¸æŠï¼‰
3. **ã‚¢ãƒ—ãƒªæƒ…å ±**ã‚’å…¥åŠ›ï¼š
   - ã‚¢ãƒ—ãƒªå: ä¾‹ï¼‰`GrowMate GSC Integration`
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«: ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
   - ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã®é€£çµ¡å…ˆæƒ…å ±: ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
4. **ã‚¹ã‚³ãƒ¼ãƒ—**ã‚’è¿½åŠ ï¼š
   - ã€Œã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã¾ãŸã¯å‰Šé™¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
   - `https://www.googleapis.com/auth/webmasters.readonly` ã‚’è¿½åŠ ï¼ˆSearch Console API ã®èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
   - **GA4é€£æºã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ**: `https://www.googleapis.com/auth/analytics.readonly` ã‚‚è¿½åŠ ï¼ˆGA4 Data API / Admin API ã®èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
5. **ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‚’è¿½åŠ ï¼ˆå¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—ã®å ´åˆï¼‰ï¼š
   - ã€Œãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã€
   - GSC é€£æºã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ 
   - **é‡è¦**: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯èªè¨¼ã§ãã¾ã›ã‚“

##### 5.1.3 OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã®ä½œæˆ

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€ã«ç§»å‹•
2. ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€ã‚’é¸æŠ
3. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡**ã‚’ã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã«è¨­å®š
4. **åå‰**ã‚’å…¥åŠ›ï¼ˆä¾‹: `GrowMate GSC OAuth Client`ï¼‰
5. **æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI**ã‚’è¿½åŠ ï¼š
   - **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨**: `http://localhost:3000/api/gsc/oauth/callback`
   - **ngrok åˆ©ç”¨æ™‚**: `https://your-static-domain.ngrok-free.dev/api/gsc/oauth/callback`ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
   - **æœ¬ç•ªç’°å¢ƒç”¨**: `https://your-domain.com/api/gsc/oauth/callback`
   - **é‡è¦**: ä½¿ç”¨ã™ã‚‹ç’°å¢ƒã«å¿œã˜ã¦é©åˆ‡ãª URI ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚ngrok ã®é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚Œã°ã€URL ã¯å›ºå®šã•ã‚Œã‚‹ãŸã‚ä¸€åº¦è¨­å®šã™ã‚Œã°å¤‰æ›´ä¸è¦ã§ã™
6. ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
7. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID** ã¨ **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ** ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå¾Œã§ `.env.local` ã«è¨­å®šã—ã¾ã™ï¼‰

##### 5.1.4 å¿…è¦ãª API ã®æœ‰åŠ¹åŒ–

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã«ç§»å‹•
2. ä»¥ä¸‹ã® API ã‚’æ¤œç´¢ã—ã¦æœ‰åŠ¹åŒ–ï¼š
   - **Google Search Console API**ï¼ˆGSCé€£æºã«å¿…é ˆï¼‰
   - **Google Analytics Data API**ï¼ˆGA4é€£æºã«å¿…é ˆï¼‰
   - **Google Analytics Admin API**ï¼ˆGA4é€£æºã«å¿…é ˆï¼‰

#### 5.2 ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ä½œæˆã—ãŸ OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ `.env.local` ã«è¨­å®šã—ã¾ã™ï¼š

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Google Search Console / GA4 OAuth è¨­å®šï¼ˆGSC/GA4é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GOOGLE_OAUTH_CLIENT_ID=your_google_oauth_client_id
GOOGLE_OAUTH_CLIENT_SECRET=your_google_oauth_client_secret
GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=http://localhost:3000/api/gsc/oauth/callback  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚
# GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=https://your-static-domain.ngrok-free.dev/api/gsc/oauth/callback  # ngrok åˆ©ç”¨æ™‚ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
# GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=https://your-domain.com/api/gsc/oauth/callback  # æœ¬ç•ªç’°å¢ƒ
```

**redirect_uri ã®ä½¿ã„åˆ†ã‘:**

- **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º**: `http://localhost:3000/api/gsc/oauth/callback` ã‚’ä½¿ç”¨ï¼ˆGoogle Cloud Console ã«ã‚‚åŒã˜ URI ã‚’ç™»éŒ²ï¼‰
- **ngrok åˆ©ç”¨æ™‚**: é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ï¼ˆä¾‹: `https://your-static-domain.ngrok-free.dev/api/gsc/oauth/callback`ï¼‰ã€‚ä¸€åº¦è¨­å®šã™ã‚Œã°å¤‰æ›´ä¸è¦
- **æœ¬ç•ªç’°å¢ƒ**: ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ï¼ˆä¾‹: `https://your-domain.com/api/gsc/oauth/callback`ï¼‰

**é‡è¦**:

- é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ç•°ãªã‚‹ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™
- Google Cloud Console ã®ã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URIã€ã¨ `.env.local` ã® `GOOGLE_SEARCH_CONSOLE_REDIRECT_URI` ã¯å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- ngrok ã®é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚Œã° URL ã¯å›ºå®šã•ã‚Œã‚‹ãŸã‚ã€Google Cloud Console ã®è¨­å®šå¤‰æ›´ã¯ä¸è¦ã§ã™

#### 5.3 æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

##### æ­£å¸¸ãªå‹•ä½œãƒ•ãƒ­ãƒ¼

1. `/setup/gsc` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€ŒGoogle Search Console ã¨é€£æºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. Google èªè¨¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã€ä»¥ä¸‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ï¼š
   - `webmasters.readonly`ï¼ˆGSCé€£æºç”¨ï¼‰
   - `analytics.readonly`ï¼ˆGA4é€£æºç”¨ã€GA4é€£æºã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
3. èªè¨¼å®Œäº†å¾Œã€`/api/gsc/oauth/callback` çµŒç”±ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‡¦ç†ã•ã‚Œã‚‹
4. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã€Search Console ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆã‚µã‚¤ãƒˆï¼‰ã‚’é¸æŠã§ãã‚‹
5. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠå¾Œã€Supabase `gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã«èªè¨¼æƒ…å ±ãŒä¿å­˜ã•ã‚Œã‚‹

##### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

##### ã‚¨ãƒ©ãƒ¼: `redirect_uri_mismatch`

- **åŸå› **: Google Cloud Console ã®ã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URIã€ã¨ `.env.local` ã® `GOOGLE_SEARCH_CONSOLE_REDIRECT_URI` ãŒä¸€è‡´ã—ã¦ã„ãªã„
- **å¯¾å‡¦**: ä¸¡æ–¹ã®è¨­å®šã‚’ç¢ºèªã—ã€å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹ï¼ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ãƒ›ã‚¹ãƒˆã€ãƒ‘ã‚¹ã™ã¹ã¦ï¼‰

##### ã‚¨ãƒ©ãƒ¼: `access_denied` ã¾ãŸã¯èªè¨¼ç”»é¢ã§ã€Œã“ã®ã‚¢ãƒ—ãƒªã¯ç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“ã€

- **åŸå› **: OAuth consent screen ã§ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹
- **å¯¾å‡¦**: Google Cloud Console ã®ã€ŒOAuth consent screenã€â†’ã€Œãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã«ã€ä½¿ç”¨ã™ã‚‹ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ 

##### ã‚¨ãƒ©ãƒ¼: ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€ã¾ãŸã¯ç©ºã®ãƒªã‚¹ãƒˆ

- **åŸå› **:
  - Search Console API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„
  - èªè¨¼ã—ãŸ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« Search Console ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„
  - ã‚¹ã‚³ãƒ¼ãƒ—ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„
- **å¯¾å‡¦**:
  - Google Cloud Console ã§ Search Console API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  - èªè¨¼ã«ä½¿ç”¨ã—ãŸ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ [Search Console](https://search.google.com/search-console) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
  - OAuth consent screen ã®ã‚¹ã‚³ãƒ¼ãƒ—ã« `webmasters.readonly` ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

##### ã‚¨ãƒ©ãƒ¼: `invalid_client`

- **åŸå› **: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã¾ãŸã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒé–“é•ã£ã¦ã„ã‚‹
- **å¯¾å‡¦**: `.env.local` ã® `GOOGLE_OAUTH_CLIENT_ID` ã¨ `GOOGLE_OAUTH_CLIENT_SECRET` ã‚’ç¢ºèª

##### æ¨©é™ä¸è¶³æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

- `Error: The caller does not have permission` â†’ Search Console API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯èªè¨¼ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„
- `Error: Insufficient Permission` â†’ OAuth consent screen ã®ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®šãŒä¸ååˆ†

### 6. Google Ads ã®è¨­å®šï¼ˆGoogle Ads é€£æºæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

#### 6.1 Google Cloud Console ã§ã®è¨­å®š

**é‡è¦**: Google Ads é€£æºæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€Google Cloud Console ã§ OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚GSC é€£æºã¨åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã§ãã¾ã™ãŒã€åˆ¥é€”ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

##### 6.1.1 OAuth consent screen ã®è¨­å®š

Google Ads é€£æºã§ã¯ã€GSC é€£æºã¨åŒã˜ OAuth consent screen ã‚’ä½¿ç”¨ã§ãã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€ŒOAuth consent screenã€ã«ç§»å‹•
2. **ã‚¹ã‚³ãƒ¼ãƒ—**ã‚’è¿½åŠ ï¼š
   - `https://www.googleapis.com/auth/adwords`ï¼ˆGoogle Ads API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
   - `https://www.googleapis.com/auth/userinfo.email`ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼‰
   - `openid`ï¼ˆOpenID Connectï¼‰

**æ³¨æ„**: GSC é€£æºã¨ Google Ads é€£æºã§åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ä¸¡æ–¹ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

##### 6.1.2 OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã®è¨­å®š

GSC é€£æºã¨åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€æ—¢å­˜ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã‚’è¿½åŠ ã—ã¾ã™ï¼š

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€ã«ç§»å‹•
2. æ—¢å­˜ã® OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’é¸æŠï¼ˆã¾ãŸã¯æ–°è¦ä½œæˆï¼‰
3. **æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI**ã‚’è¿½åŠ ï¼š
   - **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨**: `http://localhost:3000/api/google-ads/oauth/callback`
   - **ngrok åˆ©ç”¨æ™‚**: `https://your-static-domain.ngrok-free.dev/api/google-ads/oauth/callback`ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
   - **æœ¬ç•ªç’°å¢ƒç”¨**: `https://your-domain.com/api/google-ads/oauth/callback`

##### 6.1.3 Google Ads API ã®æœ‰åŠ¹åŒ–

1. ã€ŒAPI ã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã«ç§»å‹•
2. ã€ŒGoogle Ads APIã€ã‚’æ¤œç´¢
3. ã€Œæœ‰åŠ¹ã«ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

##### 6.1.4 é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—

Google Ads API ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™ï¼š

1. [Google Ads](https://ads.google.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. MCCï¼ˆMy Client Centerï¼‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. ã€Œãƒ„ãƒ¼ãƒ«ã¨è¨­å®šã€â†’ã€Œè¨­å®šã€â†’ã€ŒAPIã‚»ãƒ³ã‚¿ãƒ¼ã€ã«ç§»å‹•
4. ã€Œé–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€æ—¢å­˜ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèªã™ã‚‹ã‹ã€æ–°è¦ã«ç”³è«‹
5. é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå¾Œã§ `.env.local` ã«è¨­å®šã—ã¾ã™ï¼‰

**é‡è¦**: é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã¯ MCC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ã®ã¿ãŒå–å¾—ãƒ»ç®¡ç†ã§ãã¾ã™ã€‚

#### 6.2 ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ä½œæˆã—ãŸ OAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `.env.local` ã«è¨­å®šã—ã¾ã™ï¼š

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Google Ads OAuth è¨­å®šï¼ˆGoogle Adsé€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# æ³¨æ„: GSCé€£æºã¨åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã§ãã¾ã™
GOOGLE_OAUTH_CLIENT_ID=your_google_oauth_client_id  # GSCé€£æºã¨åŒã˜å€¤ã‚’ä½¿ç”¨å¯èƒ½
GOOGLE_OAUTH_CLIENT_SECRET=your_google_oauth_client_secret  # GSCé€£æºã¨åŒã˜å€¤ã‚’ä½¿ç”¨å¯èƒ½
GOOGLE_ADS_REDIRECT_URI=http://localhost:3000/api/google-ads/oauth/callback  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚
# GOOGLE_ADS_REDIRECT_URI=https://your-static-domain.ngrok-free.dev/api/google-ads/oauth/callback  # ngrok åˆ©ç”¨æ™‚ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
# GOOGLE_ADS_REDIRECT_URI=https://your-domain.com/api/google-ads/oauth/callback  # æœ¬ç•ªç’°å¢ƒ
# Google Ads API é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆMCCã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ãŒç™ºè¡Œï¼‰
GOOGLE_ADS_DEVELOPER_TOKEN=your_google_ads_developer_token
```

**redirect_uri ã®ä½¿ã„åˆ†ã‘:**

- **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º**: `http://localhost:3000/api/google-ads/oauth/callback` ã‚’ä½¿ç”¨ï¼ˆGoogle Cloud Console ã«ã‚‚åŒã˜ URI ã‚’ç™»éŒ²ï¼‰
- **ngrok åˆ©ç”¨æ™‚**: é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ï¼ˆä¾‹: `https://your-static-domain.ngrok-free.dev/api/google-ads/oauth/callback`ï¼‰ã€‚ä¸€åº¦è¨­å®šã™ã‚Œã°å¤‰æ›´ä¸è¦
- **æœ¬ç•ªç’°å¢ƒ**: ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ï¼ˆä¾‹: `https://your-domain.com/api/google-ads/oauth/callback`ï¼‰

**é‡è¦**:

- Google Cloud Console ã®ã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URIã€ã¨ `.env.local` ã® `GOOGLE_ADS_REDIRECT_URI` ã¯å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- GSC é€£æºã¨ Google Ads é€£æºã§åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ä¸¡æ–¹ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„
- é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ã¯ MCC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ã®ã¿ãŒå–å¾—ã§ãã¾ã™

#### 6.3 æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

##### æ­£å¸¸ãªå‹•ä½œãƒ•ãƒ­ãƒ¼

1. `/setup/google-ads` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
2. Google èªè¨¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã€`adwords` ã‚¹ã‚³ãƒ¼ãƒ—ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹
3. èªè¨¼å®Œäº†å¾Œã€`/api/google-ads/oauth/callback` çµŒç”±ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‡¦ç†ã•ã‚Œã‚‹
4. MCC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå ´åˆã€é…ä¸‹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã€é¸æŠå¯èƒ½
5. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒ1ã¤ã®å ´åˆã¯è‡ªå‹•çš„ã«é¸æŠã€è¤‡æ•°ã®å ´åˆã¯é¸æŠç”»é¢ã‚’è¡¨ç¤º
6. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠå¾Œã€Supabase `google_ads_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã«èªè¨¼æƒ…å ±ã¨é¸æŠã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãŒä¿å­˜ã•ã‚Œã‚‹

##### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

##### ã‚¨ãƒ©ãƒ¼: `redirect_uri_mismatch`

- **åŸå› **: Google Cloud Console ã®ã€Œæ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URIã€ã¨ `.env.local` ã® `GOOGLE_ADS_REDIRECT_URI` ãŒä¸€è‡´ã—ã¦ã„ãªã„
- **å¯¾å‡¦**: ä¸¡æ–¹ã®è¨­å®šã‚’ç¢ºèªã—ã€å®Œå…¨ã«ä¸€è‡´ã•ã›ã‚‹ï¼ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ãƒ›ã‚¹ãƒˆã€ãƒ‘ã‚¹ã™ã¹ã¦ï¼‰

##### ã‚¨ãƒ©ãƒ¼: `invalid_client`

- **åŸå› **: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã¾ãŸã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒé–“é•ã£ã¦ã„ã‚‹
- **å¯¾å‡¦**: `.env.local` ã® `GOOGLE_OAUTH_CLIENT_ID` ã¨ `GOOGLE_OAUTH_CLIENT_SECRET` ã‚’ç¢ºèª

##### ã‚¨ãƒ©ãƒ¼: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€ã¾ãŸã¯ç©ºã®ãƒªã‚¹ãƒˆ

- **åŸå› **:
  - Google Ads API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„
  - é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯ç„¡åŠ¹
  - èªè¨¼ã—ãŸ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« Google Ads ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„
- **å¯¾å‡¦**:
  - Google Cloud Console ã§ Google Ads API ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  - `.env.local` ã® `GOOGLE_ADS_DEVELOPER_TOKEN` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  - èªè¨¼ã«ä½¿ç”¨ã—ãŸ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ [Google Ads](https://ads.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª

##### ã‚¨ãƒ©ãƒ¼: `æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“`ï¼ˆ403ã‚¨ãƒ©ãƒ¼ï¼‰

- **åŸå› **: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠæ™‚ã«ã€`listAccessibleCustomers` ã§å–å¾—ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ã«å«ã¾ã‚Œãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’æŒ‡å®šã—ãŸ
- **å¯¾å‡¦**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠç”»é¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¸­ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ã€‚è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“

### 8. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Supabase è¨­å®š
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SUPABASE_SERVICE_ROLE=your_supabase_service_role_key
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# LINE è¨­å®š
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
LINE_CHANNEL_ID=your_line_channel_id
LINE_CHANNEL_SECRET=your_line_channel_secret
NEXT_PUBLIC_LIFF_ID=your_liff_id
NEXT_PUBLIC_LIFF_CHANNEL_ID=your_line_channel_id

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Stripe è¨­å®š
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STRIPE_ENABLED=true  # Stripe ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹å ´åˆã¯ false
STRIPE_SECRET_KEY=sk_test_xxxxx
STRIPE_PRICE_ID=price_xxxxx
NEXT_PUBLIC_STRIPE_ENABLED=true  # çœç•¥æ™‚ã¯ STRIPE_ENABLED ã‚’ç¶™æ‰¿

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# AI API ã‚­ãƒ¼
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ANTHROPIC_API_KEY=sk-ant-xxxxx
OPENAI_API_KEY=sk-proj-xxxxx

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ã‚µã‚¤ãƒˆ URL
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
NEXT_PUBLIC_SITE_URL=https://your-static-domain.ngrok-free.dev  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ï¼ˆngroké™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
# NEXT_PUBLIC_SITE_URL=https://your-domain.com  # æœ¬ç•ªç’°å¢ƒ

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# WordPress.com OAuth è¨­å®šï¼ˆä»»æ„ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
WORDPRESS_COM_CLIENT_ID=your_wordpress_com_client_id
WORDPRESS_COM_CLIENT_SECRET=your_wordpress_com_client_secret
WORDPRESS_COM_REDIRECT_URI=https://your-static-domain.ngrok-free.dev/api/wordpress/oauth/callback
COOKIE_SECRET=your_random_32_char_secret_key  # openssl rand -hex 32 ã§ç”Ÿæˆ

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Google Search Console / GA4 OAuth è¨­å®šï¼ˆä»»æ„ã€GSC/GA4é€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# è©³ç´°ã¯ã€Œ5. Google Search Console / GA4 ã®è¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
# æ³¨æ„: GA4é€£æºã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€OAuthåŒæ„ç”»é¢ã§ `analytics.readonly` ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
GOOGLE_OAUTH_CLIENT_ID=your_google_oauth_client_id
GOOGLE_OAUTH_CLIENT_SECRET=your_google_oauth_client_secret
GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=http://localhost:3000/api/gsc/oauth/callback  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚
# GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=https://your-static-domain.ngrok-free.dev/api/gsc/oauth/callback  # ngrok åˆ©ç”¨æ™‚ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
# GOOGLE_SEARCH_CONSOLE_REDIRECT_URI=https://your-domain.com/api/gsc/oauth/callback  # æœ¬ç•ªç’°å¢ƒ

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Google Ads OAuth è¨­å®šï¼ˆä»»æ„ã€Google Adsé€£æºåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# è©³ç´°ã¯ã€Œ6. Google Ads ã®è¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
# æ³¨æ„: GSCé€£æºã¨åŒã˜ OAuth ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ä½¿ç”¨ã§ãã¾ã™
GOOGLE_ADS_REDIRECT_URI=http://localhost:3000/api/google-ads/oauth/callback  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚
# GOOGLE_ADS_REDIRECT_URI=https://your-static-domain.ngrok-free.dev/api/google-ads/oauth/callback  # ngrok åˆ©ç”¨æ™‚ï¼ˆé™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
# GOOGLE_ADS_REDIRECT_URI=https://your-domain.com/api/google-ads/oauth/callback  # æœ¬ç•ªç’°å¢ƒ
# Google Ads API é–‹ç™ºè€…ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆMCCã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç®¡ç†è€…ãŒç™ºè¡Œï¼‰
GOOGLE_ADS_DEVELOPER_TOKEN=your_google_ads_developer_token

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cron Secretï¼ˆä»»æ„ï¼šGSCè©•ä¾¡ãƒãƒƒãƒåˆ©ç”¨æ™‚ã¯å¿…é ˆï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# GSC è©•ä¾¡ãƒãƒƒãƒå®Ÿè¡Œç”¨ã®å…±æœ‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆBearer èªè¨¼ï¼‰
# ç”Ÿæˆæ–¹æ³•: openssl rand -hex 32
CRON_SECRET=your_random_32_char_secret_key
```

**é‡è¦**: `.env.local` ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ Vercel ã®ç’°å¢ƒå¤‰æ•°è¨­å®šã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

### 9. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# Next.js é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:3000` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚
å‹ãƒã‚§ãƒƒã‚¯ã‚’ä¸¦è¡Œã§è¡Œã†å ´åˆã¯ `npm run dev:types` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### 10. LIFF ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®ãŸã‚ã® ngrok ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå¿…é ˆï¼‰

LIFF ã¯HTTPSç’°å¢ƒãŒå¿…é ˆã®ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ ngrok ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

#### 10.1 ngrok ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. [ngrok](https://ngrok.com/) ã«ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
2. ngrok ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã«è¨­å®šï¼š
   ```bash
   ngrok config add-authtoken <your-authtoken>
   ```
3. ngrok ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§**é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³**ã‚’ä½œæˆï¼ˆç„¡æ–™ãƒ—ãƒ©ãƒ³ã§1ã¤å–å¾—å¯èƒ½ï¼‰
   - ä¾‹: `your-name.ngrok-free.app` ã¾ãŸã¯ `xxx.ngrok-free.dev`
4. `.env.local` ã«é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šï¼š
   ```bash
   NEXT_PUBLIC_SITE_URL=https://your-static-domain.ngrok-free.dev
   ```

#### 10.2 ngrok ã®èµ·å‹•ã¨ãƒ†ã‚¹ãƒˆç”¨è¨­å®š

```bash
# .env.local ã® NEXT_PUBLIC_SITE_URL ã‹ã‚‰è‡ªå‹•ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å–å¾—ã—ã¦èµ·å‹•
npm run ngrok
```

é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€URL ãŒå›ºå®šã•ã‚Œã€LINE Developers Console ã® LIFF ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã‚’æ¯å›å¤‰æ›´ã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚

**ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®åˆ¶é™**:

- é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ **1ã¤ã¾ã§**
- **å•†ç”¨åˆ©ç”¨ã¯ä¸å¯**ï¼ˆé–‹ç™ºãƒ»æ¤œè¨¼ç”¨é€”ã®ã¿ï¼‰
- è¤‡æ•°äººã§é–‹ç™ºã™ã‚‹å ´åˆã¯ã€å„è‡ªãŒç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å–å¾—

**æ³¨æ„**:

- LINE Developers Console ã® LIFF ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL ã«ã¯é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„
- ngrok ã®é™çš„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆï¼ˆ`http://localhost:3000`ï¼‰ã¯ä½¿ç”¨ã—ã¾ã›ã‚“

### 11. å‹•ä½œç¢ºèªã¨æ¤œè¨¼

#### 11.1 Lint ãƒã‚§ãƒƒã‚¯

```bash
npm run lint
```

#### 11.2 ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯

```bash
npm run build
npm run start
```

#### 11.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆç¢ºèª

```bash
npm run db:stats
```

#### 11.4 Vercel çµ±è¨ˆç¢ºèªï¼ˆVercel ã«ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ã®å ´åˆï¼‰

```bash
npm run vercel:stats
```

#### 11.5 GSC é€£æºã®æ‰‹å‹•æ¤œè¨¼ï¼ˆGSC é€£æºæ©Ÿèƒ½ã‚’å¤‰æ›´ã—ãŸå ´åˆï¼‰

GSC é€£æºæ©Ÿèƒ½ã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§å‹•ä½œç¢ºèªã‚’è¡Œã„ã€PR ã«æ¤œè¨¼çµæœã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼š

1. **OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼ã®ç¢ºèª**
   - `/setup/gsc` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã€ŒGoogle Search Console ã¨é€£æºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - Google èªè¨¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã€é©åˆ‡ãªã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆ`webmasters.readonly`ï¼‰ãŒè¦æ±‚ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - èªè¨¼å®Œäº†å¾Œã€`/api/gsc/oauth/callback` çµŒç”±ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - Supabase `gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `refresh_token` ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

2. **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠã®ç¢ºèª**
   - èªè¨¼å®Œäº†å¾Œã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é¸æŠã—ã€`gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `property_uri` ãŒæ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã®ç¢ºèª**
   - `/app/gsc-dashboard` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€GSC ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - ã‚°ãƒ©ãƒ•ã‚„çµ±è¨ˆæƒ…å ±ãŒé©åˆ‡ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

4. **ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ç¢ºèª**
   - `/app/gsc-import` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
   - ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã€`gsc_page_metrics` ã¨ `gsc_query_metrics` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

5. **é€£æºè§£é™¤ã®ç¢ºèª**
   - `/setup/gsc` ã‹ã‚‰é€£æºè§£é™¤ã‚’å®Ÿè¡Œã—ã€`gsc_credentials` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰è©²å½“ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå‰Šé™¤ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

6. **è¨˜äº‹è©•ä¾¡ãƒ»ææ¡ˆã‚·ã‚¹ãƒ†ãƒ ã®ç¢ºèª**
   - `/api/cron/gsc-evaluate`ï¼ˆã¾ãŸã¯ `/api/gsc/evaluate` ã«ã‚ˆã‚‹æ‰‹å‹•å®Ÿè¡Œï¼‰ã«ã‚ˆã‚Šè©•ä¾¡ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - è©•ä¾¡å®Ÿè¡Œå¾Œã€`gsc_article_evaluations` ãƒ†ãƒ¼ãƒ–ãƒ«ã«è©•ä¾¡ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆãƒ»æ›´æ–°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - `gsc_article_evaluation_history` ãƒ†ãƒ¼ãƒ–ãƒ«ã«è©•ä¾¡å±¥æ­´ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - `current_suggestion_stage` ãŒæ®µéšçš„ã«é·ç§»ã™ã‚‹ã“ã¨ï¼ˆã‚¿ã‚¤ãƒˆãƒ« â†’ æ›¸ãå‡ºã— â†’ æœ¬æ–‡ â†’ ãƒšãƒ«ã‚½ãƒŠï¼‰ã‚’ç¢ºèª
     - åˆæœŸè©•ä¾¡æ™‚ã¯ `current_suggestion_stage = 1`ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã‹ã‚‰é–‹å§‹
     - æ”¹å–„ãŒç¢ºèªã•ã‚Œãªã„å ´åˆã€æ¬¡ã®è©•ä¾¡ã‚µã‚¤ã‚¯ãƒ«ã§ `current_suggestion_stage` ãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - æ”¹å–„ãŒç¢ºèªã§ããŸå ´åˆï¼ˆ`outcome_type = 'improved'` ãªã©ï¼‰ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãŒãƒªã‚»ãƒƒãƒˆï¼ˆ`current_suggestion_stage = 1`ï¼‰ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - è©•ä¾¡é–“éš”ãŒ30æ—¥ã§è¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

**PR ã¸ã®è¨˜è¼‰ä¾‹:**

- æ¤œè¨¼æ—¥æ™‚ã¨ç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/æœ¬ç•ªï¼‰
- å„ã‚¹ãƒ†ãƒƒãƒ—ã®å®Ÿè¡Œçµæœï¼ˆæˆåŠŸ/å¤±æ•—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¾ãŸã¯å†ç¾æ‰‹é †
- Supabase ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèªçµæœï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

#### 11.6 ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…ã®æ‰‹å‹•æ¤œè¨¼ï¼ˆã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…æ©Ÿèƒ½ã‚’å¤‰æ›´ã—ãŸå ´åˆï¼‰

ã‚¹ã‚¿ãƒƒãƒ•æ‹›å¾…æ©Ÿèƒ½ã‚’å¤‰æ›´ã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§å‹•ä½œç¢ºèªã‚’è¡Œã„ã€PR ã«æ¤œè¨¼çµæœã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼š

1. **æ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆã¨æœ‰åŠ¹æ€§ã®ç¢ºèª**
   - `/` ã®ã€Œã‚¹ã‚¿ãƒƒãƒ•ã‚’æ‹›å¾…ã™ã‚‹ã€ã‹ã‚‰æ‹›å¾…ãƒªãƒ³ã‚¯ã‚’ç™ºè¡Œã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
   - ç”Ÿæˆã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™å†…ã§æœ‰åŠ¹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆæœŸé™åˆ‡ã‚Œæ™‚ã¯ç„¡åŠ¹ã«ãªã‚‹ã“ã¨ï¼‰
   - 1å›é™ã‚Šã®ä½¿ç”¨åˆ¶å¾¡ã‚„å†ç™ºè¡Œæ™‚ã®ç„¡åŠ¹åŒ–ãŒæƒ³å®šã©ãŠã‚Šã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

2. **ãƒˆãƒ¼ã‚¯ãƒ³å—ã‘ä»˜ã‘ãƒ•ãƒ­ãƒ¼ã®ç¢ºèª**
   - `/invite/[token]/page.tsx` ã§æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ãå—ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - ç„¡åŠ¹ãƒ»æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ã‚¹ã‚¿ãƒƒãƒ•é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã®ç¢ºèª**
   - ã‚ªãƒ¼ãƒŠãƒ¼ãŒã‚¹ã‚¿ãƒƒãƒ•é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆãŸéš›ã€Cookie ãŒä»˜ä¸ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
   - `authMiddleware` ãŒé–²è¦§çŠ¶æ…‹ã‚’æ­£ã—ãåˆ¤å®šã—ã€æƒ³å®šã©ãŠã‚Šã®æ¨©é™ã§è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

4. **æ¨©é™ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®ç¢ºèª**
   - ã‚ªãƒ¼ãƒŠãƒ¼ä»¥å¤–ãŒæ‹›å¾…ç®¡ç† API ã‚’å®Ÿè¡Œã—ãŸå ´åˆã«æ‹’å¦ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆ403 ãªã©ï¼‰
   - ã‚¹ã‚¿ãƒƒãƒ•å‰Šé™¤å¾Œã€ã‚ªãƒ¼ãƒŠãƒ¼æ¨©é™ãŒå¾©å¸°ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

**PR ã¸ã®è¨˜è¼‰ä¾‹:**

- æ¤œè¨¼æ—¥æ™‚ã¨ç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«/æœ¬ç•ªï¼‰
- å„ã‚¹ãƒ†ãƒƒãƒ—ã®å®Ÿè¡Œçµæœï¼ˆæˆåŠŸ/å¤±æ•—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¾ãŸã¯å†ç¾æ‰‹é †
- Supabase ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèªçµæœï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### 12. åˆæœŸãƒ‡ãƒ¼ã‚¿ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆå›ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå¾Œã€ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã„ã¾ã™ï¼š

1. **ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ã®ä»˜ä¸**: Supabase ã® `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã§è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® `role` ã‚’ `admin` ã«å¤‰æ›´
2. **äº‹æ¥­è€…æƒ…å ±ã®ç™»éŒ²**: `/business-info` ã§ 5W2H ãªã©ã®åŸºæœ¬æƒ…å ±ã‚’å…¥åŠ›
3. **WordPress é€£æº**ï¼ˆä»»æ„ï¼‰: `/setup/wordpress` ã§ WordPress ã‚µã‚¤ãƒˆã‚’æ¥ç¶š
4. **Google Search Console / GA4 é€£æº**ï¼ˆä»»æ„ï¼‰: `/setup/gsc` ã§ GSC ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ¥ç¶š
5. **Google Ads é€£æº**ï¼ˆä»»æ„ã€ç®¡ç†è€…ã®ã¿ï¼‰: `/setup/google-ads` ã§ Google Ads ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¥ç¶š
6. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç¢ºèª**: `/admin/prompts` ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç¢ºèªãƒ»ç·¨é›†

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®ãƒã‚¤ãƒ³ãƒˆ

- `npm run lint` ã§ ESLint + Next/Tailwind ãƒ«ãƒ¼ãƒ«ã‚’æ¤œè¨¼
- `npm run build` â†’ `npm run start` ã§æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã®å¥å…¨æ€§ã‚’ãƒã‚§ãƒƒã‚¯
- **Supabase ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´**: æœ¬ç•ªç’°å¢ƒã¨å…±æœ‰ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¯å¿…ãšç®¡ç†è€…ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ `supabase/migrations/` ã« SQL ã‚’è¿½åŠ ã—ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã«æ®‹ã—ã¾ã™
- **ãƒ‡ãƒ¼ã‚¿æ“ä½œã®æ³¨æ„**: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã¨åŒã˜DBã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¯è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«ç´ä»˜ã‘ã¦ä½œæˆã—ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª¤ã£ã¦å¤‰æ›´ãƒ»å‰Šé™¤ã—ãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„
- **LINEè¨­å®šã®æ³¨æ„**: æœ¬ç•ªç’°å¢ƒã¨LINE ChannelãŠã‚ˆã³LIFFã‚¢ãƒ—ãƒªã‚’å…±æœ‰ã—ã¦ã„ã‚‹ãŸã‚ã€LINE Developers Consoleã§ã®è¨­å®šå¤‰æ›´ã¯çµ¶å¯¾ã«è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚è¨­å®šå¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯å¿…ãšç®¡ç†è€…ã«ç›¸è«‡ã—ã¦ãã ã•ã„
- LIFF æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã¯æœ¬ç•ªç’°å¢ƒã§å®Ÿæ–½ã™ã‚‹ã‹ã€ç®¡ç†è€…ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãã ã•ã„
- TypeScript strict ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªãŸã‚ã€å‹ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã—ã¦ã‹ã‚‰ commit ã™ã‚‹

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ chat/                # AI ãƒãƒ£ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆCanvas / Annotation / Step UIï¼‰
â”‚   â”œâ”€â”€ analytics/           # WordPress æŠ•ç¨¿ + æ³¨é‡ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ business-info/       # äº‹æ¥­è€…æƒ…å ±ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆServer Components + Actionsï¼‰
â”‚   â”œâ”€â”€ setup/               # WordPress / GSC ç­‰ã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å°ç·š
â”‚   â”œâ”€â”€ login/               # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ home/                # ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆéèªè¨¼å¯ï¼‰
â”‚   â”œâ”€â”€ privacy/             # ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ï¼ˆéèªè¨¼å¯ï¼‰
â”‚   â”œâ”€â”€ unauthorized/        # æœªèªå¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ unavailable/         # åˆ©ç”¨ä¸å¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒšãƒ¼ã‚¸ï¼ˆrole ãŒ unavailable ã®å ´åˆï¼‰
â”‚   â”œâ”€â”€ wordpress-import/    # WordPress è¨˜äº‹ã®ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ gsc-dashboard/       # GSC ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ gsc-import/          # GSC ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ admin/               # ç®¡ç†è€…å‘ã‘æ©Ÿèƒ½ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ api/                 # Route Handlersï¼ˆchat, wordpress, admin, auth, user, line, gsc, cronï¼‰
â”‚   â””â”€â”€ layout.tsx ãªã©      # App Router ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å†åˆ©ç”¨å¯èƒ½ãª UIï¼ˆshadcn/ui, AnnotationFormFields ç­‰ï¼‰
â”‚   â”œâ”€â”€ domain/              # ãƒ•ãƒ­ãƒ³ãƒˆå‘ã‘ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆChatService / SubscriptionServiceï¼‰
â”‚   â”œâ”€â”€ hooks/               # LIFF / ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ / UI ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ lib/                 # å®šæ•°ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ãƒ»Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ actions/         # Server Actions çµŒç”±ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ middleware/      # èªè¨¼ãƒ»ãƒ­ãƒ¼ãƒ«åˆ¤å®šãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”œâ”€â”€ services/        # çµ±åˆå±¤ï¼ˆStripe / WordPress / Supabase / LLM / GSC ãªã©ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chatService.ts            # ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ gscService.ts             # GSC åŸºæœ¬æ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ gscEvaluationService.ts   # GSC è¨˜äº‹è©•ä¾¡å‡¦ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ gscSuggestionService.ts   # GSC æ”¹å–„ææ¡ˆç”Ÿæˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ gscImportService.ts       # GSC ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ analyticsContentService.ts # ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‡¦ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ chatLimitService.ts       # ãƒãƒ£ãƒƒãƒˆåˆ¶é™ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ ... ãã®ä»–ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ schemas/         # Zod ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚   â””â”€â”€ lib/             # ã‚µãƒ¼ãƒãƒ¼å°‚ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ types/               # å…±é€šå‹å®šç¾©ï¼ˆchat, prompt, annotation, wordpress ç­‰ï¼‰
â”œâ”€â”€ scripts/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆDB çµ±è¨ˆãƒ»Vercel çµ±è¨ˆï¼‰
â”œâ”€â”€ claudedocs/              # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ
â”œâ”€â”€ supabase/migrations/     # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â””â”€â”€ config files             # eslint.config.mjs, next.config.ts, tailwind/postcss è¨­å®š
```

## ğŸ”§ ä¸»ãª API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                    | ãƒ¡ã‚½ãƒƒãƒ‰ | æ¦‚è¦                                                        | èªè¨¼                           |
| --------------------------------- | -------- | ----------------------------------------------------------- | ------------------------------ |
| `/api/chat/anthropic/stream`      | POST     | Claude ã¨ã®ãƒãƒ£ãƒƒãƒˆ SSE ã‚¹ãƒˆãƒªãƒ¼ãƒ                           | `Authorization: Bearer <LIFF>` |
| `/api/chat/canvas/stream`         | POST     | Canvas ç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆé¸æŠç¯„å›²å·®ã—æ›¿ãˆï¼‰                   | `Authorization: Bearer <LIFF>` |
| `/api/chat/canvas/load-wordpress` | POST     | WordPressè¨˜äº‹ã‚’Canvasã«èª­ã¿è¾¼ã¿                             | `Authorization: Bearer <LIFF>` |
| `/api/refresh`                    | POST     | LINE ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å†ç™ºè¡Œ         | Cookie (`line_refresh_token`)  |
| `/api/user/current`               | GET      | ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ­ãƒ¼ãƒ«æƒ…å ±                  | Cookie (`line_access_token`)   |
| `/api/auth/check-role`            | GET      | ãƒ­ãƒ¼ãƒ«ã®ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼                                        | Cookie                         |
| `/api/auth/clear-cache`           | POST     | Edge ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢é€šçŸ¥                                   | ä»»æ„                           |
| `/api/auth/line-oauth-init`       | GET      | LINE OAuth stateç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                          | Cookie                         |
| `/api/line/callback`              | GET      | LINE OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯                                     | å…¬é–‹ï¼ˆstate ãƒã‚§ãƒƒã‚¯ã‚ã‚Šï¼‰     |
| `/api/wordpress/settings`         | GET/POST | WordPress è¨­å®šã®å–å¾—ãƒ»ä¿å­˜ï¼ˆserver action ã¨å…±æœ‰ï¼‰          | Cookie                         |
| `/api/wordpress/status`           | GET      | WordPress æ¥ç¶šçŠ¶æ³ã®ç¢ºèª                                    | Cookie                         |
| `/api/wordpress/posts`            | GET      | WordPress æŠ•ç¨¿ä¸€è¦§ã®å–å¾—                                    | Cookie + WP èªè¨¼               |
| `/api/wordpress/test-connection`  | POST     | WordPress æ¥ç¶šãƒ†ã‚¹ãƒˆ                                        | Cookie                         |
| `/api/wordpress/oauth/start`      | GET      | WordPress.com OAuth ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆé–‹å§‹                        | å…¬é–‹ï¼ˆç’°å¢ƒå¤‰æ•°å¿…é ˆï¼‰           |
| `/api/wordpress/oauth/callback`   | GET      | WordPress.com OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯                            | Cookie                         |
| `/api/admin/prompts`              | GET      | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ï¼ˆç®¡ç†è€…å°‚ç”¨ï¼‰                    | Cookie + admin ãƒ­ãƒ¼ãƒ«          |
| `/api/admin/prompts/[id]`         | POST     | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç”Ÿæˆ                            | Cookie + admin ãƒ­ãƒ¼ãƒ«          |
| `/api/gsc/status`                 | GET      | GSCé€£æºçŠ¶æ…‹ç¢ºèª                                             | Cookie                         |
| `/api/gsc/oauth/start`            | GET      | GSC OAuth ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆé–‹å§‹                                  | å…¬é–‹ï¼ˆç’°å¢ƒå¤‰æ•°å¿…é ˆï¼‰           |
| `/api/gsc/oauth/callback`         | GET      | GSC OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯                                      | Cookie                         |
| `/api/gsc/disconnect`             | POST     | GSCé€£æºè§£é™¤                                                 | Cookie                         |
| `/api/gsc/properties`             | GET      | GSCãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§å–å¾—                                       | Cookie                         |
| `/api/gsc/property`               | POST     | GSCãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠ                                           | Cookie                         |
| `/api/gsc/dashboard`              | GET      | GSCãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—                                 | Cookie                         |
| `/api/gsc/import`                 | POST     | GSCãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ                                         | Cookie                         |
| `/api/gsc/evaluate`               | POST     | GSCè¨˜äº‹è©•ä¾¡ã®æ‰‹å‹•å®Ÿè¡Œ                                       | Cookie                         |
| `/api/gsc/evaluations`            | GET      | GSCè©•ä¾¡å±¥æ­´å–å¾—                                             | Cookie                         |
| `/api/ga4/status`                 | GET      | GA4é€£æºçŠ¶æ…‹ç¢ºèª                                             | Cookie                         |
| `/api/ga4/properties`             | GET      | GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸€è¦§å–å¾—                                       | Cookie                         |
| `/api/ga4/property`               | POST     | GA4ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸æŠ                                           | Cookie                         |
| `/api/ga4/dashboard`              | GET      | GA4ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—                                 | Cookie                         |
| `/api/cron/gsc-evaluate`          | POST     | GSCè¨˜äº‹è©•ä¾¡ã®å®šæœŸå®Ÿè¡Œï¼ˆå¤–éƒ¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©çµŒç”±ã§ Bearer èªè¨¼ï¼‰ | Authorization ãƒ˜ãƒƒãƒ€ãƒ¼         |
| `/api/google-ads/oauth/start`     | GET      | Google Ads OAuth ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆé–‹å§‹                           | å…¬é–‹ï¼ˆç’°å¢ƒå¤‰æ•°å¿…é ˆï¼‰           |
| `/api/google-ads/oauth/callback`  | GET      | Google Ads OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯                               | Cookie                         |
| `/api/google-ads/accounts`        | GET      | Google Adsã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§å–å¾—                                | Cookie + admin ãƒ­ãƒ¼ãƒ«          |
| `/api/google-ads/accounts/select` | POST     | Google Adsã‚¢ã‚«ã‚¦ãƒ³ãƒˆé¸æŠä¿å­˜                                | Cookie + admin ãƒ­ãƒ¼ãƒ«          |

### GSC è©•ä¾¡ãƒãƒƒãƒï¼ˆå¤–éƒ¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‹ã‚‰ã®å®Ÿè¡Œï¼‰

- Vercel ç’°å¢ƒå¤‰æ•°: `CRON_SECRET` ã‚’è¨­å®šï¼ˆCronãƒãƒƒãƒç”¨ã®å…±æœ‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰
- èªè¨¼: `Authorization: Bearer <CRON_SECRET>` ãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãã§ `/api/cron/gsc-evaluate` ã‚’å‘¼ã³å‡ºã—
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: é‹ç”¨ä¸­ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã§ä»»æ„ã«è¨­å®š

ã‚µãƒ¼ãƒãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (`src/server/actions/*`) ã§ã¯ã€ãƒ–ãƒªãƒ¼ãƒ•ä¿å­˜ãƒ»WordPress æŠ•ç¨¿å–å¾—ãƒ»æ³¨é‡ˆ upsertãƒ»Stripe ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãªã©ã‚’å‹å®‰å…¨ã«å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨é‹ç”¨ã®æ³¨æ„ç‚¹

- Supabase ã§ã¯ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã« RLS ã‚’é©ç”¨æ¸ˆã¿ï¼ˆé–‹ç™ºãƒãƒªã‚·ãƒ¼ãŒæ®‹ã‚‹ç®‡æ‰€ã¯é‹ç”¨å‰ã«è¦‹ç›´ã™ï¼‰
- `authMiddleware` ãŒãƒ­ãƒ¼ãƒ«ãƒ»ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¤œè¨¼ã—ã€`requiresSubscription` ã§ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã‚’ä¿è­·
- `get_accessible_user_ids` ã¨ RLS ã«ã‚ˆã‚Šã€ã‚ªãƒ¼ãƒŠãƒ¼/ã‚¹ã‚¿ãƒƒãƒ•ã®å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ã¨ã‚ªãƒ¼ãƒŠãƒ¼èª­ã¿å–ã‚Šå°‚ç”¨ã‚’æ‹…ä¿
- WordPress ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„ OAuth ãƒˆãƒ¼ã‚¯ãƒ³ã¯ HTTP-only Cookie ã«ä¿å­˜ï¼ˆæœ¬ç•ªã§ã¯å®‰å…¨ãª KMS / Secrets ç®¡ç†ã‚’æ¨å¥¨ï¼‰
- SSE ã¯ 20 ç§’ã”ã¨ã® ping ã¨ 5 åˆ†ã‚¢ã‚¤ãƒ‰ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§æ¥ç¶šç¶­æŒã‚’èª¿æ•´
- `AnnotationPanel` ã® URL æ­£è¦åŒ–ã§å†…éƒ¨ï¼ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆã¸ã®èª¤ç™»éŒ²ã‚’é˜²æ­¢

## ğŸ—„ï¸ Supabase ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆFreeãƒ—ãƒ©ãƒ³ / é€±æ¬¡ï¼‰

Freeãƒ—ãƒ©ãƒ³ã¯Supabaseã®æ¨™æº–ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½¿ãˆãªã„ãŸã‚ã€GitHub Actions + GCSã§é€±æ¬¡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
Storageã¯å¯¾è±¡å¤–ï¼ˆDBã®ã¿ï¼‰ã§ã™ã€‚

### 1. GCS ãƒã‚±ãƒƒãƒˆä½œæˆ

- ãƒã‚±ãƒƒãƒˆå: `grow_mate`
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: `us-central1`ï¼ˆFreeæ å¯¾è±¡ï¼‰
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹: Standard
- ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«: **60æ—¥ã§å‰Šé™¤**

### 2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

- å¯¾è±¡ãƒã‚±ãƒƒãƒˆã« `roles/storage.objectCreator` ã‚’ä»˜ä¸ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿ï¼‰
- JSONã‚­ãƒ¼ã‚’ä½œæˆã—ã€GitHub Secretsã«ç™»éŒ²

### 3. GitHub Secrets

- `GCP_PROJECT_ID` = `gen-lang-client-0146717482`
- `GCS_BUCKET_NAME` = `grow_mate`
- `GCP_SERVICE_ACCOUNT_KEY` = ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆJSON
- `SUPABASE_DB_URL` = Supabaseã®DBæ¥ç¶šæ–‡å­—åˆ—ï¼ˆService Roleã§æ¥ç¶šã§ãã‚‹ã‚‚ã®ï¼‰

### 4. å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

- `.github/workflows/supabase-backup.yml`
- **æ—¥æ›œ12:00 JST**ï¼ˆUTC 03:00ï¼‰ã§é€±æ¬¡å®Ÿè¡Œ
- ã‚¹ã‚­ãƒ¼ãƒ/ãƒ‡ãƒ¼ã‚¿/ãƒ­ãƒ¼ãƒ«ã‚’å€‹åˆ¥ã«ãƒ€ãƒ³ãƒ— â†’ gzip â†’ GCSä¿å­˜

### 5. publicãƒªãƒã‚¸ãƒˆãƒªã®æ³¨æ„

publicãƒªãƒã‚¸ãƒˆãƒªã¯**60æ—¥ç„¡æ´»å‹•ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè‡ªå‹•åœæ­¢**ã•ã‚Œã‚‹ãŸã‚ã€ä»¥ä¸‹ã®Keepaliveã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

- `.github/workflows/keepalive.yml`
- æœˆ1å›ã€`.github/keepalive/last-run.txt` ã‚’æ›´æ–°ã—ã¦ã‚³ãƒŸãƒƒãƒˆ

### 6. å¾©æ—§æ‰‹é †ï¼ˆæœ€ä½é™ï¼‰

1. GCSã‹ã‚‰ `.sql.gz` ã‚’å–å¾—
2. `gunzip` ã§å±•é–‹
3. `psql` ã§ **role â†’ schema â†’ data** ã®é †ã«é©ç”¨

â€» `supabase db dump` ã¯ `auth` / `storage` ãªã©ã®ç®¡ç†ã‚¹ã‚­ãƒ¼ãƒã‚’é™¤å¤–ã—ã¾ã™ï¼ˆä»•æ§˜ï¼‰

## ğŸ“± ãƒ‡ãƒ—ãƒ­ã‚¤ã¨é‹ç”¨

- Vercel ã‚’æƒ³å®šï¼ˆEdge Runtime ã¨ Node.js Runtime ã‚’ãƒ«ãƒ¼ãƒˆã”ã¨ã«åˆ‡ã‚Šåˆ†ã‘ï¼‰
- ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯: `npm run lint` â†’ `npm run build`
- ç’°å¢ƒå¤‰æ•°ã¯ Vercel Project Settings ã¸åæ˜ ã—ã€æœ¬ç•ªã¯ Stripe æœ¬ç•ªã‚­ãƒ¼ãƒ»WordPress æœ¬ç•ªã‚µã‚¤ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ
- Supabase ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `npx supabase db push` ã§åŒæœŸã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰ã‚’å¸¸ã«æ›´æ–°

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
2. å¤‰æ›´ã‚’å®Ÿè£…ã—ã€`npm run lint` ã®çµæœã‚’ç¢ºèª
3. å¿…è¦ã«å¿œã˜ã¦ Supabase ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã‚’æ˜è¨˜
4. å¤‰æ›´å†…å®¹ã‚’ç°¡æ½”ã«ã¾ã¨ã‚ãŸ PR ã‚’ä½œæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿ãƒ»ç’°å¢ƒå¤‰æ•°ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ·»ä»˜ï¼‰

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ç§çš„åˆ©ç”¨ç›®çš„ã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚å†é…å¸ƒã‚„å•†ç”¨åˆ©ç”¨ã¯äº‹å‰ç›¸è«‡ã®ã†ãˆã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚
