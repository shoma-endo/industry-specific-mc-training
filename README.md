# Industry-Specific MC Training Platform

LINEèªè¨¼ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸæ¥­ç•Œç‰¹åŒ–å‹AIãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚Fine-tuned AIãƒ¢ãƒ‡ãƒ«ã€åºƒå‘Š/LP/ãƒ–ãƒ­ã‚°å‘ã‘ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¾¤ã€Canvasæç”»æ©Ÿèƒ½ã€WordPressé€£æºã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ±ºæ¸ˆã‚’çµ±åˆã—ãŸåŒ…æ‹¬çš„ãªSaaSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## ğŸš€ ä¸»è¦æ©Ÿèƒ½

### ğŸ“± LINE LIFFèªè¨¼

- LINE Loginã«ã‚ˆã‚‹ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªèªè¨¼
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ»ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ç®¡ç†è€…æ¨©é™ã«ã‚ˆã‚‹éšå±¤åŒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- Row Level Securityï¼ˆRLSï¼‰ã«ã‚ˆã‚‹å³æ ¼ãªãƒ‡ãƒ¼ã‚¿åˆ†é›¢

### ğŸ¤– AIãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´æ©Ÿèƒ½

- **Fine-tuned AIãƒ¢ãƒ‡ãƒ«**ï¼š`ft:gpt-4.1-nano-2025-04-14` ã«ã‚ˆã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†é¡
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½“ç³»**ï¼šåºƒå‘Šæ–‡ï¼ˆä½œæˆ/ä»•ä¸Šã’ï¼‰ã€16ãƒ‘ãƒ¼ãƒˆLPè‰æ¡ˆ/æ”¹å–„ã€7ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ–ãƒ­ã‚°ä½œæˆãƒ•ãƒ­ãƒ¼ãªã©è¤‡æ•°ã®æ¥­å‹™ç‰¹åŒ–ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æä¾›
- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†**ï¼šç®¡ç†è€…å°‚ç”¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç·¨é›†ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ãƒ»å¤‰æ•°ä»˜ããƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†
- **å¤–éƒ¨APIçµ±åˆ**ï¼šGoogleæ¤œç´¢å›æ•°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆâ€»æ¤œç´¢APIæœ¬ä½“ã¯å»ƒæ­¢æ¸ˆã¿ï¼‰
- **ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½**ï¼šAnthropic Claude Sonnet-4.5ï¼ˆ`claude-sonnet-4-5-20250929`ï¼‰ã¨ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ä¼šè©±ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€AIãƒ¢ãƒ‡ãƒ«é¸æŠ

### ğŸ¨ ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ä½œæˆãƒ»WordPressé€£æº

- **WordPress.com / ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ WordPress**ï¼šä¸¡æ–¹å¼å¯¾å¿œ
- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½**ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ä¸‹æ›¸ããƒ¢ãƒ¼ãƒ‰
- **OAuthèªè¨¼**ï¼šWordPress.com é€£æº
- **Application Password**ï¼šã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ WordPress å¯¾å¿œ

### ğŸ–¼ï¸ Canvasæç”»æ©Ÿèƒ½

- **TipTap 3.0.7**ï¼šãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒªãƒ³ã‚¯ãƒ»ç”»åƒãƒ»ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- **AIçµ±åˆ**ï¼šãƒãƒ£ãƒƒãƒˆè¿”ä¿¡ã®ç›´æ¥æŒ¿å…¥ãƒ»è¦‹å‡ºã—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å¤šå½¢å¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### ğŸ’³ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ»æ¨©é™ç®¡ç†

- **Stripe Checkout**ï¼šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†
- **ä½¿ç”¨é‡åˆ¶é™**ï¼šGoogleæ¤œç´¢å›æ•°åˆ¶é™ãƒ»ãƒ—ãƒ©ãƒ³åˆ¥æ©Ÿèƒ½åˆ¶å¾¡
- **ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆ2025å¹´8æœˆæœ€æ–°ç‰ˆï¼‰

```mermaid
graph TB
    subgraph "Frontend Layer"
        A[Next.js 15 App Router]
        B[React 19 Components]
        C[Canvas / TipTap Editor]
        D[LIFF Hooks]
    end

    subgraph "Authentication"
        E[LINE LIFF 2.25]
        F[Token Auto-Refresh Middleware]
    end

    subgraph "Business Logic"
        G[Server Actions]
        H[Prompt Template Service]
        I[WordPress Integration]
        J[Chat Streaming Controller]
    end

    subgraph "Data Layer"
        K[Supabase PostgreSQL + RLS]
        L[Prompt Templates & Versions]
        M[WordPress Settings]
    end

    subgraph "AI Models"
        N[Fine-tuned OpenAI GPT-4.1 Nano]
    O[Anthropic Claude Sonnet-4.5]
    end

    subgraph "External APIs"
        R[Stripe 17.7]
        S[WordPress REST / OAuth]
        T[Google Search Quota Tracker]
        V[LINE Platform API]
    end

    A --> E
    A --> G
    B --> C
    C --> J
    E --> F
    F --> G
    G --> H
    G --> I
    G --> K
    H --> L
    I --> M
    J --> O
    H --> N
    G --> R
    I --> S
    G --> T
    F --> V
```

## ğŸ”„ èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as User
    participant C as Client
    participant L as LINE Platform
    participant S as Server
    participant DB as Supabase

    U->>C: ã‚¢ãƒ—ãƒªã‚¢ã‚¯ã‚»ã‚¹
    C->>L: LIFFåˆæœŸåŒ–
    alt æœªèªè¨¼ã®å ´åˆ
        C->>L: LINE Login
        L->>U: èªè¨¼ç”»é¢è¡¨ç¤º
        U->>L: èªè¨¼è¨±å¯
        L->>C: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
    end
    C->>S: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    S->>L: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    L->>S: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    S->>DB: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¿å­˜/æ›´æ–°
    S->>C: èªè¨¼å®Œäº†
```

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Next.js 15.4.7 + React 19 + TypeScript 5 + Tailwind CSS 4 + Radix UI + TipTap 3.0.7
**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Supabase 2.49.1ï¼ˆPostgreSQL + RLSï¼‰+ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ/WordPressé€£æºã‚µãƒ¼ãƒ“ã‚¹
**AI**: OpenAI GPT-4.1 Nanoï¼ˆFine-tunedï¼‰+ Anthropic Claude Sonnet-4.5ï¼ˆ`claude-sonnet-4-5-20250929`ï¼‰
**å¤–éƒ¨API**: Google Custom Searchï¼ˆå›æ•°ã‚«ã‚¦ãƒ³ãƒˆã®ã¿ï¼‰+ LINE LIFF 2.25.1 + Stripe 17.7 + WordPress REST API
**é–‹ç™º**: Vercel + Husky + ESLint 9 + Prettier + tsc-watch + ngrok

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

```mermaid
erDiagram
    users {
        uuid id PK
        text line_user_id UK
        text line_display_name
        text line_picture_url
        text line_status_message
        text stripe_customer_id
        text stripe_subscription_id
        text role
        text full_name
        integer google_search_count
        timestamp google_search_reset_at
        timestamp last_login_at
        bigint created_at
        bigint updated_at
    }

    chat_sessions {
        text id PK
        uuid user_id FK
        text title
        text system_prompt
        bigint last_message_at
        bigint created_at
    }

    chat_messages {
        text id PK
        uuid user_id FK
        text session_id FK
        text role
        text content
        text model
        bigint created_at
    }

    wordpress_settings {
        uuid id PK
        uuid user_id FK
        text wp_type
        text wp_client_id
        text wp_client_secret
        text wp_site_id
        text wp_site_url
        text wp_username
        text wp_application_password
        timestamp created_at
        timestamp updated_at
    }


    prompt_templates {
        uuid id PK
        text name UK
        text description
        text content
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }

    prompt_versions {
        uuid id PK
        uuid template_id FK
        text content
        text change_description
        timestamp created_at
    }

    briefs {
        uuid id PK
        uuid user_id FK
        text name
        jsonb content
        timestamp created_at
        timestamp updated_at
    }


    users ||--o{ chat_sessions : has
    users ||--o{ chat_messages : owns
    users ||--o{ briefs : creates
    users ||--o| wordpress_settings : configures
    chat_sessions ||--o{ chat_messages : contains
    prompt_templates ||--o{ prompt_versions : has
```

## ğŸ“‹ ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆå…¨19é …ç›®ï¼‰

`src/env.ts` ã§å‹å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼/ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç’°å¢ƒå¤‰æ•°ã¯ä»¥ä¸‹ã®19é …ç›®ã§ã™ã€‚`.env.example` ã¯ãƒªãƒã‚¸ãƒˆãƒªã«å«ã¾ã‚Œãªã„ãŸã‚ã€`.env.local` ã‚’æ‰‹å‹•ã§ä½œæˆã—ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚

| ç¨®åˆ¥ | å¤‰æ•°å | å¿…é ˆ | ç”¨é€” |
| ---- | ------ | ---- | ---- |
| Server | `DBPASS` | âœ… | Supabase ã‹ã‚‰æ¥ç¶šã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| Server | `SUPABASE_SERVICE_ROLE` | âœ… | ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰å‡¦ç†ã§ä½¿ç”¨ã™ã‚‹ Service Role ã‚­ãƒ¼ |
| Server | `STRIPE_ENABLED` | ä»»æ„ | Stripe ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ãƒ•ãƒ©ã‚°ï¼ˆ`true/false`ï¼‰ |
| Server | `STRIPE_SECRET_KEY` | âœ…ï¼ˆæ±ºæ¸ˆæœ‰åŠ¹æ™‚ï¼‰ | Stripe ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ |
| Server | `STRIPE_PRICE_ID` | âœ…ï¼ˆæ±ºæ¸ˆæœ‰åŠ¹æ™‚ï¼‰ | Stripe ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã® Price ID |
| Server | `OPENAI_API_KEY` | âœ… | Fine-tuned ãƒ¢ãƒ‡ãƒ«åˆ©ç”¨æ™‚ã® OpenAI ã‚­ãƒ¼ |
| Server | `ANTHROPIC_API_KEY` | âœ… | Claude ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”¨ API ã‚­ãƒ¼ |
| Server | `GOOGLE_CUSTOM_SEARCH_KEY` | âœ… | Google Custom Search API ã‚­ãƒ¼ï¼ˆå›æ•°ã‚«ã‚¦ãƒ³ãƒˆã§åˆ©ç”¨ï¼‰ |
| Server | `GOOGLE_CSE_ID` | âœ… | Google Custom Search Engine ID |
| Server | `LINE_CHANNEL_ID` | âœ… | LINE Login ç”¨ãƒãƒ£ãƒãƒ« ID |
| Server | `LINE_CHANNEL_SECRET` | âœ… | LINE Login ç”¨ãƒãƒ£ãƒãƒ«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ |
| Server | `BASE_WEBHOOK_URL` | âœ… | ãƒ­ã‚°è»¢é€å…ˆï¼ˆLark Base ãªã©ï¼‰ã® Webhook URL |
| Server | `RELAY_BEARER_TOKEN` | âœ… | `/api/log-relay` ã® Bearer èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ |
| Client | `NEXT_PUBLIC_LIFF_ID` | âœ… | LIFF ã‚¢ãƒ—ãƒª ID |
| Client | `NEXT_PUBLIC_LIFF_CHANNEL_ID` | âœ… | LIFF Channel ID |
| Client | `NEXT_PUBLIC_SUPABASE_URL` | âœ… | Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ URL |
| Client | `NEXT_PUBLIC_SUPABASE_ANON_KEY` | âœ… | Supabase anon ã‚­ãƒ¼ |
| Client | `NEXT_PUBLIC_SITE_URL` | âœ… | ã‚µã‚¤ãƒˆå…¬é–‹ URL |
| Client | `NEXT_PUBLIC_STRIPE_ENABLED` | ä»»æ„ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã® Stripe æœ‰åŠ¹åŒ–ãƒ•ãƒ©ã‚° |

### è¿½åŠ ã§åˆ©ç”¨ã§ãã‚‹ä»»æ„è¨­å®š

- `WORDPRESS_COM_CLIENT_ID`, `WORDPRESS_COM_CLIENT_SECRET`, `WORDPRESS_COM_REDIRECT_URI`: WordPress.com OAuth ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã«å¿…è¦ã€‚
- `OAUTH_STATE_COOKIE_NAME`, `OAUTH_TOKEN_COOKIE_NAME`: WordPress OAuth çŠ¶æ…‹ç®¡ç†ç”¨ã‚¯ãƒƒã‚­ãƒ¼åã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹éš›ã«åˆ©ç”¨ã€‚
- `COOKIE_SECRET`: WordPress OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å®‰å…¨ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«å¿…é ˆã€‚
- `RELAY_PROJECT_ID`: `/api/log-relay` ã®è‡ªå·±ãƒ«ãƒ¼ãƒ—é˜²æ­¢ç”¨ã«è¨­å®šå¯èƒ½ã€‚

## ğŸš€ ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

### 1. å‰ææ¡ä»¶

- Node.js 18.x ä»¥ä¸Š
- npm ã¾ãŸã¯ yarn
- Supabase ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- LINE Developers ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ±ºæ¸ˆæ©Ÿèƒ½ä½¿ç”¨æ™‚ï¼‰

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
git clone <repository-url> && cd industry-specific-mc-training
npm install
# .env.local ã‚’ä½œæˆã—ä¸Šè¨˜19é …ç›®ã‚’è¨­å®š
npx supabase db push       # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npm run dev               # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run ngrok             # LINE LIFFç”¨HTTPSãƒˆãƒ³ãƒãƒ«ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
```

### WordPressé€£æºè¨­å®š

**WordPress.com**: [Developer Console](https://developer.wordpress.com/apps/) ã§Client ID/Secretå–å¾—
**ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ**: ç®¡ç†ç”»é¢ã‹ã‚‰Application Passwordç”Ÿæˆ

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œãƒ»2025å¹´8æœˆï¼‰

```
â”œâ”€â”€ app/                       # Next.js App Routerï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
â”‚   â”œâ”€â”€ admin/                # ç®¡ç†è€…æ©Ÿèƒ½ï¼ˆæ¨©é™åˆ¶å¾¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ prompts/         # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”‚   â””â”€â”€ layout.tsx       # ç®¡ç†è€…ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ api/                 # API Routes
â”‚   â”‚   â”œâ”€â”€ admin/         # ç®¡ç†è€…å°‚ç”¨APIï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»çµ±è¨ˆï¼‰
â”‚   â”‚   â”œâ”€â”€ auth/          # ãƒ­ãƒ¼ãƒ«ç¢ºèªãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
â”‚   â”‚   â”œâ”€â”€ chat/          # Anthropicã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°API
â”‚   â”‚   â”œâ”€â”€ line/          # LINEèªè¨¼API
â”‚   â”‚   â”œâ”€â”€ log-relay/     # Vercel Log Drain ä¸­ç¶™
â”‚   â”‚   â”œâ”€â”€ refresh/       # LINEãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
â”‚   â”‚   â”œâ”€â”€ user/          # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±API
â”‚   â”‚   â””â”€â”€ wordpress/     # WordPressé€£æºAPI
â”‚   â”œâ”€â”€ chat/               # ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ components/     # ãƒãƒ£ãƒƒãƒˆå°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ CanvasPanel.tsx    # Canvasæç”»ãƒ‘ãƒãƒ«
â”‚   â”‚   â”‚   â”œâ”€â”€ InputArea.tsx      # AIãƒ¢ãƒ‡ãƒ«é¸æŠãƒ»å…¥åŠ›
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageArea.tsx    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
â”‚   â”‚   â”‚   â””â”€â”€ SessionSidebar.tsx # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ page.tsx        # ãƒãƒ£ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ analytics/          # ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹è¡¨ç¤º
â”‚   â”œâ”€â”€ business-info/      # äº‹æ¥­æƒ…å ±å…¥åŠ›
â”‚   â”œâ”€â”€ setup/              # åˆæœŸè¨­å®šã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰
â”‚   â””â”€â”€ subscription/       # ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†
â””â”€â”€ src/                    # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆçµ±åˆæ¸ˆã¿ï¼‰
    â”œâ”€â”€ components/         # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”‚   â””â”€â”€ ui/            # shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    â”œâ”€â”€ domain/            # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‰ãƒªãƒ–ãƒ³è¨­è¨ˆ
    â”‚   â”œâ”€â”€ errors/        # ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹
    â”‚   â”œâ”€â”€ interfaces/    # ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    â”‚   â”œâ”€â”€ models/        # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
    â”‚   â””â”€â”€ services/      # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
    â”œâ”€â”€ hooks/             # React ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
    â”œâ”€â”€ lib/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»å®šæ•°
    â”œâ”€â”€ server/            # ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯
    â”‚   â”œâ”€â”€ handler/actions/ # Server Actions
    â”‚   â”œâ”€â”€ middleware/      # èªè¨¼ãƒ»æ¨©é™ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
    â”‚   â””â”€â”€ services/        # å¤–éƒ¨APIãƒ»ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
    â””â”€â”€ types/             # TypeScriptå‹å®šç¾©
```

## ğŸ”§ ä¸»è¦ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ç®¡ç†è€…å‘ã‘

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ä¸»ãªå½¹å‰² | èªè¨¼ |
| -------------- | -------- | -------- | ---- |
| `/api/admin/prompts` | GET | å…¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¸€è¦§å–å¾— | LINEã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ + ç®¡ç†è€…ãƒ­ãƒ¼ãƒ« |
| `/api/admin/prompts/[id]` | GET/POST | å€‹åˆ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é–²è¦§ãƒ»æ›´æ–° | LINEã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ + ç®¡ç†è€…ãƒ­ãƒ¼ãƒ« |
| `/api/admin/wordpress/stats` | GET | WordPressé€£æºçŠ¶æ³ã®é›†è¨ˆ | LINEã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ + ç®¡ç†è€…ãƒ­ãƒ¼ãƒ« |

### èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ä¸»ãªå½¹å‰² | èªè¨¼ |
| -------------- | -------- | -------- | ---- |
| `/api/line/callback` | GET | LINE OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ | å…¬é–‹ï¼ˆstate ãƒã‚§ãƒƒã‚¯ã‚ã‚Šï¼‰ |
| `/api/refresh` | POST | LINE ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰å†ç™ºè¡Œ | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/auth/check-role` | GET | ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ç¢ºèª | LINE ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/auth/clear-cache` | POST | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢é€šçŸ¥ | ä»»æ„ï¼ˆç‰¹æ¨©æ“ä½œä¸è¦ï¼‰ |
| `/api/user/current` | GET | ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ»ãƒ­ãƒ¼ãƒ«å–å¾— | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/user/search-count` | GET | Googleæ¤œç´¢æ©Ÿèƒ½ã®æä¾›çµ‚äº†é€šçŸ¥ï¼ˆ410è¿”å´ï¼‰ | ä»»æ„ |

### WordPressé€£æº

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ä¸»ãªå½¹å‰² | èªè¨¼ |
| -------------- | -------- | -------- | ---- |
| `/api/wordpress/settings` | POST | WordPress.com/ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆè¨­å®šã®ä¿å­˜ | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/wordpress/status` | GET | WordPressæ¥ç¶šçŠ¶æ…‹ã®ç¢ºèª | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/wordpress/test-connection` | GET/POST | WordPressæ¥ç¶šãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |
| `/api/wordpress/posts` | GET | WordPressæŠ•ç¨¿ä¸€è¦§ã®å–å¾— | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie + WP èªè¨¼ |
| `/api/wordpress/oauth/start` | GET | WordPress.com OAuth ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆé–‹å§‹ | å…¬é–‹ï¼ˆWordPress OAuth ç’°å¢ƒå¤‰æ•°å¿…é ˆï¼‰ |
| `/api/wordpress/oauth/callback` | GET | WordPress.com OAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç† | LINE ã‚¢ã‚¯ã‚»ã‚¹/ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ Cookie |

### ãã®ä»–

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ä¸»ãªå½¹å‰² | èªè¨¼ |
| -------------- | -------- | -------- | ---- |
| `/api/chat/anthropic/stream` | POST | Claude Sonnet-4 ã¨ã®SSEã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° | Authorization Bearerï¼ˆLIFFã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ |
| `/api/log-relay` | POST/GET/HEAD/OPTIONS | Vercel Log Drain ã®å—ã‘å£ãƒ»Beareræ¤œè¨¼ãƒ»Webhookè»¢é€ | `Authorization: Bearer ${RELAY_BEARER_TOKEN}` |

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **Row Level Security (RLS)** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢
- **èªå¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢** - `/login`ãƒ»`/unauthorized`ãƒ»`/` ä»¥å¤–ã®ãƒšãƒ¼ã‚¸ã¯ LIFF ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³å¿…é ˆã€`/admin/*` ã¯ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«é™å®šã€`/analytics` `/business-info` `/setup` `/subscription` ãªã©ã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨
- **JWT Tokenç®¡ç†** - è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ + 5åˆ†TTLãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **CSRFä¿è­·** - çŠ¶æ…‹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹ä¿è­·
- **ç’°å¢ƒå¤‰æ•°ç®¡ç†** - @t3-oss/env-nextjs ã«ã‚ˆã‚‹å‹å®‰å…¨ãªæ©Ÿå¯†æƒ…å ±ç®¡ç†
- **ä½¿ç”¨é‡åˆ¶é™** - Googleæ¤œç´¢APIåˆ¶é™ãƒ»ãƒ—ãƒ©ãƒ³åˆ¥æ©Ÿèƒ½ã‚²ãƒ¼ãƒˆ

## ğŸ“± ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Vercel ãƒ‡ãƒ—ãƒ­ã‚¤

1. Vercel ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¥ç¶š
3. ç’°å¢ƒå¤‰æ•°è¨­å®š
4. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

### ç’°å¢ƒå›ºæœ‰è¨­å®š

- **é–‹ç™ºç’°å¢ƒ**: ngrok + ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
- **ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°**: Vercel ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒ
- **æœ¬ç•ªç’°å¢ƒ**: Vercel æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

**ä¸»è¦ãƒšãƒ¼ã‚¸**: `/chat`ï¼ˆAIãƒãƒ£ãƒƒãƒˆï¼‰, `/admin`ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ï¼‰, `/business-info`ï¼ˆäº‹æ¥­æƒ…å ±å…¥åŠ›ï¼‰, `/subscription`ï¼ˆæ±ºæ¸ˆç®¡ç†ï¼‰

## ğŸ“ˆ 2025å¹´8æœˆæœ€æ–°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

**æ–°æ©Ÿèƒ½**: Canvasæç”»ï¼ˆTipTap 3.0.7ï¼‰ã€å¤šæ®µãƒ–ãƒ­ã‚°ä½œæˆãƒ•ãƒ­ãƒ¼ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€WordPressé€£æºå¼·åŒ–ã€ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: Clean Architectureæº–æ‹ ã€å‹å®‰å…¨æ€§å‘ä¸Šï¼ˆ19é …ç›®ã®å‹ä»˜ãç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼‰
**é–‹ç™ºåŠ¹ç‡**: ESLint 9 + Prettierçµ±åˆã€è‡ªå‹•å“è³ªç®¡ç†

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
2. å¤‰æ›´å®Ÿè£…ãƒ»TypeScriptå‹ãƒã‚§ãƒƒã‚¯ãƒ»ESLint
3. Husky pre-commit hooks ã«ã‚ˆã‚‹è‡ªå‹•ãƒ†ã‚¹ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
4. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ç§çš„åˆ©ç”¨ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
