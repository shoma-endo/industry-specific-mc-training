<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
  <style>
    .title { font: bold 24px sans-serif; fill: #333; }
    .policy-title { font: bold 16px sans-serif; fill: #333; }
    .policy-desc { font: 14px sans-serif; fill: #333; }
    .policy-box { fill: #F8FAFC; stroke: #94A3B8; stroke-width: 2; }
    .code-box { fill: #F1F5F9; stroke: #CBD5E1; stroke-width: 1; }
    .code-text { font: 12px monospace; fill: #333; }
    .table-name { font: bold 18px sans-serif; fill: #333; }
    .users-box { fill: #EFF6FF; stroke: #3B82F6; stroke-width: 2; }
    .sessions-box { fill: #E0F2FE; stroke: #0EA5E9; stroke-width: 2; }
    .messages-box { fill: #DCFCE7; stroke: #10B981; stroke-width: 2; }
  </style>
  
  <!-- Title -->
  <text x="400" y="40" text-anchor="middle" class="title">Supabase Row Level Security (RLS) ポリシー</text>
  
  <!-- Users Table Policies -->
  <rect x="50" y="80" width="700" height="150" rx="8" class="users-box" />
  <text x="400" y="105" text-anchor="middle" class="table-name">users テーブル</text>
  
  <rect x="70" y="120" width="660" height="100" rx="4" class="code-box" />
  <text x="80" y="140" class="code-text">-- 認証済みユーザーは自分のレコードのみ読み取り可能</text>
  <text x="80" y="160" class="code-text">CREATE POLICY "ユーザー自身のデータ読み取り" ON "public"."users"</text>
  <text x="80" y="180" class="code-text">FOR SELECT USING (auth.uid() = id);</text>
  <text x="80" y="200" class="code-text">-- 認証済みユーザーは自分のレコードのみ更新可能</text>
  <text x="80" y="220" class="code-text">CREATE POLICY "ユーザー自身のデータ更新" ON "public"."users"</text>
  <text x="80" y="240" class="code-text">FOR UPDATE USING (auth.uid() = id);</text>
  
  <!-- Chat Sessions Table Policies -->
  <rect x="50" y="250" width="700" height="150" rx="8" class="sessions-box" />
  <text x="400" y="275" text-anchor="middle" class="table-name">chat_sessions テーブル</text>
  
  <rect x="70" y="290" width="660" height="100" rx="4" class="code-box" />
  <text x="80" y="310" class="code-text">-- 認証済みユーザーは自分のセッションのみ読み取り可能</text>
  <text x="80" y="330" class="code-text">CREATE POLICY "ユーザー自身のセッション読み取り" ON "public"."chat_sessions"</text>
  <text x="80" y="350" class="code-text">FOR SELECT USING (auth.uid() = user_id);</text>
  <text x="80" y="370" class="code-text">-- 認証済みユーザーは自分のセッションのみ作成可能</text>
  <text x="80" y="390" class="code-text">CREATE POLICY "ユーザー自身のセッション作成" ON "public"."chat_sessions"</text>
  <text x="80" y="410" class="code-text">FOR INSERT WITH CHECK (auth.uid() = user_id);</text>
  
  <!-- Chat Messages Table Policies -->
  <rect x="50" y="420" width="700" height="160" rx="8" class="messages-box" />
  <text x="400" y="445" text-anchor="middle" class="table-name">chat_messages テーブル</text>
  
  <rect x="70" y="460" width="660" height="110" rx="4" class="code-box" />
  <text x="80" y="480" class="code-text">-- 認証済みユーザーは自分のセッションのメッセージのみ読み取り可能</text>
  <text x="80" y="500" class="code-text">CREATE POLICY "ユーザー自身のメッセージ読み取り" ON "public"."chat_messages"</text>
  <text x="80" y="520" class="code-text">FOR SELECT USING (</text>
  <text x="80" y="540" class="code-text">  EXISTS (</text>
  <text x="80" y="560" class="code-text">    SELECT 1 FROM chat_sessions WHERE id = chat_messages.session_id AND user_id = auth.uid()</text>
  <text x="80" y="580" class="code-text">  )</text>
  <text x="80" y="600" class="code-text">);</text>
</svg>
