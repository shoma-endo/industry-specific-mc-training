---
name: self-review
description: コーディング完了後の「2回のセルフレビュー」手順。品質、型安全、命名規則、プロジェクト規約の遵守を保証。
---

# セルフレビュー・プロトコル

全てのコーディング作業完了後、返信前に必ず以下の 2 パスのセルフレビューを実行してください。

## Pass 1: 静的解析と整合性 (Verification)

このパスでは、コードが正しく動作し、プロジェクトの基本ルールに沿っているかを確認します。

- [ ] **静的解析**: `npm run lint` を実行し、エラーがないことを確認。
- [ ] **型安全**: TS ファイルの場合、必要に応じて `npm run dev:types` 相当の確認を行い、`any` の乱用や型不一致がないか確認。
- [ ] **命名規則**: `project-naming` スキルを読み直し、新規ファイルや変数が規約通りか確認。
- [ ] **既存破壊の防止**: 既存の `interface` や共有定数を変更した場合、その影響範囲（`rg` で検索）を調査したか。

## Pass 2: 品質とコンテキスト (Quality & Context)

このパスでは、実装がプロジェクトの設計思想やセキュリティ基準に合致しているかを確認します。

- [ ] **ドメイン・サーバー機能**: `CLAUDE.md` の実装指針（Stripe 有効化チェック、SupabaseService 経由の統一等）を遵守しているか。
- [ ] **セキュリティ**: `supabase-rls` スキルに基づき、RLS やセキュリティ定義者関数に関わる変更が安全か確認。
- [ ] **未認証ユーザーの保護**: ログイン不要なパブリックページ（`/home`, `/privacy`）に、ユーザー名や通知トーストなどの認証済み情報を漏洩させていないか。
- [ ] **成果物の記録**: セルフレビューの実施結果は、**ユーザーへの返信冒頭**で明示する（例: `[Self-Review: Passed]`）。**コミットメッセージには含めず**、既存の「1行の日本語で要約」ルールを厳守すること。

## 運用ルール

1. 修正が必要な箇所が見つかった場合は、即座に修正し、再度 Pass 1 から開始してください。
2. 複雑な機能追加の場合、実際の動作確認（手動検証）の結果もセルフレビューに含めてください。
